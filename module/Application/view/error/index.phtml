<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 */
?>

<div class="flex flex-col items-center justify-center h-screen text-center px-4 bg-gray-100">
    <div class="max-w-2xl bg-white shadow-xl rounded-2xl p-8">
        <div class="text-6xl mb-4 animate-pulse text-red-500">üí•</div>
        <h1 class="text-3xl font-extrabold text-gray-800 mb-2">An error occurred</h1>
        <p class="text-gray-600 mb-4">
            <?= $this->escapeHtml($this->message ?: 'Something went wrong on the server.') ?>
        </p>

        <?php if (!empty($this->display_exceptions)) : ?>
            <?php if (isset($this->exception) && $this->exception instanceof \Throwable) : ?>
                <div class="text-left bg-gray-50 border border-gray-200 rounded-md p-4 overflow-auto max-h-96 text-sm text-gray-800">
                    <h2 class="font-bold text-lg mb-2">Exception Details</h2>
                    <p><strong>Type:</strong> <?= get_class($this->exception) ?></p>
                    <p><strong>File:</strong> <?= $this->exception->getFile() ?>:<?= $this->exception->getLine() ?></p>
                    <p><strong>Message:</strong> <?= $this->escapeHtml($this->exception->getMessage()) ?></p>
                    <p><strong>Stack trace:</strong></p>
                    <pre class="whitespace-pre-wrap"><?= $this->escapeHtml($this->exception->getTraceAsString()) ?></pre>

                    <?php if ($ex = $this->exception->getPrevious()) : ?>
                        <hr class="my-4">
                        <h3 class="font-semibold mb-2">Previous Exceptions</h3>
                        <ul class="list-disc pl-5 space-y-2">
                            <?php $icount = 0; ?>
                            <?php while ($ex) : ?>
                                <li>
                                    <strong><?= get_class($ex) ?></strong><br>
                                    File: <?= $ex->getFile() ?>:<?= $ex->getLine() ?><br>
                                    Message: <?= $this->escapeHtml($ex->getMessage()) ?><br>
                                    <details class="mt-1"><summary class="cursor-pointer text-blue-600">Stack trace</summary>
                                        <pre class="whitespace-pre-wrap"><?= $this->escapeHtml($ex->getTraceAsString()) ?></pre>
                                    </details>
                                </li>
                                <?php
                                $ex = $ex->getPrevious();
                                if (++$icount >= 50) {
                                    echo '<li><em>Too many exceptions to display...</em></li>';
                                    break;
                                }
                                ?>
                            <?php endwhile; ?>
                        </ul>
                    <?php endif; ?>
                </div>
            <?php else : ?>
                <p class="text-sm text-gray-500 italic mt-4">No exception available.</p>
            <?php endif; ?>
        <?php endif; ?>

        <a href="/"
           class="mt-6 inline-block rounded-lg bg-gradient-to-r from-red-600 to-orange-600 px-6 py-2 text-white text-sm font-semibold shadow hover:from-red-700 hover:to-orange-700 transition">
            üîÅ Try Again / Go Home
        </a>
    </div>
</div>
