import{$ as c,d as _,r as O,s as b,a as D,b as x,i as N,c as L,f as te,p as P,e as B,g as q,h as A,j as M,k as R,l as Y,m as oe,n as ae,o as V}from"./assets/architect-COhP7iN5.js";let I=!1;const S=c("#dialog-item"),T=c("#dialog-item-form"),w=c("#item-form-btn-add"),E=c("#uom");E.data("default-options",E.html());function ne(){const u=document.getElementById("uom");c(document).on("click","a.item-edit",function(t){t.preventDefault(),I=!0,S.dialog("option","title","Edit Item"),S.dialog("open"),w.text("Save Changes"),c.ajax({url:c(this).attr("href"),type:"GET",dataType:"json"}).done(e=>{if(e.success&&e.data){const o=e.data;c("#dialog-item-form #item_uid").val(o.item_uid||""),c("#dialog-item-form #item_id").val(o.item_id||""),c("#dialog-item-form #quantity").val(o.quantity||""),c("#dialog-item-form #note").val(o.note||""),c("#dialog-item-form #uom").val(o.uom||""),h(o.item_id,o.uom,o.unit_price,o.item_uid)}else alert(e.message||"Failed to fetch item data.")}).fail((e,o,a)=>{console.error("Error deleting item:",o,a,e.responseText)})}),c("#widget-btn-add-item").on("click",function(){I=!1,S.dialog("option","title","Add Item"),S.dialog("open"),w.text("Add Item")}),c("#dialog-item").dialog({autoOpen:!1,modal:!0,minWidth:800,width:800,open:function(){O(T),c(".ui-widget-overlay").hide().fadeIn().css("z-index",1e3),c(".ui-dialog").css("z-index",2e3)},beforeClose:function(){c(".ui-widget-overlay").fadeOut(400,function(){c(this).remove()})},dialogClass:"add-item-dialog",buttons:[{id:"item-form-btn-add",text:"Save",click:function(){T.validationEngine("validate")&&(_(w,!0),I?p():d(),c(this).dialog("close"),setTimeout(()=>_(w,!1),1e3))},"aria-label":"Add Item"},{id:"item-form-btn-cancel",text:"Cancel",click:function(){c(this).dialog("close")},"aria-label":"Cancel"}]}),document.querySelector(".dialog #item_id")&&b({fieldName:".dialog #item_id",fetchUrl:"/item/index",fillFields:[{fieldSelector:"#item_id",itemKey:"item_id"},{fieldSelector:"#item_input",itemKey:"item_desc"}],minLength:2,queryParamName:"term",limitParamName:"limit",renderItem:t=>`
      <div class="autocomplete-item">
        <strong>${t.item_id}</strong><br>
        <span>${t.item_desc}</span>
      </div>`,extraSelectActions:[t=>{t.item_id&&(h(t.item_id),u.disabled=!1,u.classList.remove("disabled"))}]}),E.on("change",function(){s(c("#item_id").val(),c("#uom").val())});function h(t,e=null,o=null,a=null){t&&c.ajax({url:"/item/uom",dataType:"json",data:{term:t},type:"get"}).done(function(f){E.empty(),c.each(f,function(g,y){let v=c("<option></option>").attr("value",y.uom).text(y.uom);e&&y.uom===e&&v.attr("selected","selected"),E.append(v)}),I?l(a,x):s(t,e||c("#uom").val(),o)}).fail((f,g,y)=>{console.error("Error fetching specifier:",g,y)})}function s(t,e,o=null){!t||!e||c.ajax({url:"/item/price",data:{item_id:t,uom:e},dataType:"json"}).done(a=>{c("#unit_price").val((a==null?void 0:a.price)||o||"")}).fail((a,f,g)=>{console.error("Error fetching price:",f,g)})}function l(t,e){t&&c.ajax({url:"/item/quotedprice",data:{item_uid:t,type:e},dataType:"json"}).done(o=>{c("#unit_price").val((o==null?void 0:o.unit_price)||"")}).fail((o,a,f)=>{console.error("Error fetching price:",a,f)})}function d(){_(w,!0);let t=T.serialize()+"&project_id="+encodeURIComponent(D)+"&type="+encodeURIComponent(x);c.ajax({url:"/item/add",type:"post",data:t,contentType:"application/x-www-form-urlencoded"}).done(e=>{N.ajax.reload(),L(e.message,e.success)}).fail((e,o,a)=>{console.error("Error adding item:",o,a,e.responseText),alert("Failed to add item. Please try again.")}).always(()=>_(w,!1))}function p(){_(w,!0);let t=T.serialize()+"&type="+encodeURIComponent(x);c.ajax({url:"/item/edit",type:"post",data:t,contentType:"application/x-www-form-urlencoded"}).done(e=>{N.ajax.reload(),L(e.message,e.success)}).fail((e,o,a)=>{console.error("Error adding item:",o,a,e.responseText),alert("Failed to edit item. Please try again.")}).always(()=>_(w,!1))}c(document).on("click",".item_delete",function(t){t.preventDefault(),confirm("Are you sure you want to delete this item?")&&c.ajax({url:c(this).attr("href"),type:"GET"}).done(()=>N.ajax.reload()).fail((e,o,a)=>{console.error("Error deleting item:",o,a,e.responseText)})})}const k=$("#dialog-note-form"),F=$("#dialog-message"),j=$("#note-form-btn-add");let U=!1,Q=te("#dialog-note-form #follow_up_date",{enableTime:!0,dateFormat:"Y-m-d H:i"});function ie(){$("#dialog-message").dialog({autoOpen:!1,modal:!0,minWidth:800,width:1e3,height:650,open:function(){O(k),$(".ui-widget-overlay").hide().fadeIn().css("z-index",1e3),$(".ui-dialog").css("z-index",2e3)},beforeClose:function(){$(".ui-widget-overlay").fadeOut(400,function(){$(this).remove()})},dialogClass:"add-note-dialog",buttons:[{id:"note-form-btn-add",text:"Add Log",click:function(){k.validationEngine("validate")&&(U?h():u(),$(this).dialog("close"),setTimeout(()=>_(j,!1),1e3))},"aria-label":"Add Log"},{id:"note-form-btn-cancel",text:"Cancel",click:function(){$(this).dialog("close")},"aria-label":"Cancel"}]}),$(document).on("click",".note-edit",function(s){s.preventDefault(),U=!0,F.dialog("option","title","Edit Log"),F.dialog("open"),j.text("Save Changes"),$.ajax({url:$(this).attr("href"),type:"GET",dataType:"json"}).done(l=>{if(l.success&&l.data){const d=l.data;$("#dialog-note-form #note_id").val(d.project_note_id||""),$("#dialog-note-form #note_title").val(d.note_title||""),$("#dialog-note-form #project_note").val(d.project_note||""),$("#dialog-note-form #next_action").val(d.next_action||""),d.follow_up_date?Q.setDate(d.follow_up_date.date):Q.clear()}else alert(l.message||"Failed to fetch note data.")}).fail((l,d,p)=>{console.error("Error fetch note data:",d,p,l.responseText)})}),$("#widget-btn-add-note").on("click",function(){U=!1,F.dialog("option","title","Add Log"),F.dialog("open"),j.text("Add Note")});function u(){_(j,!0);let s=k.serialize()+"&project_id="+encodeURIComponent(D);$.ajax({url:"/note/add",type:"post",data:s,contentType:"application/x-www-form-urlencoded"}).done(l=>{P.ajax.reload(),L(l.message,l.success)}).fail((l,d,p)=>{console.error("Error adding note:",d,p,l.responseText),alert("Failed to add note. Please try again.")}).always(()=>_(j,!1))}function h(){_(j,!0);let s=k.serialize();$.ajax({url:"/note/edit",type:"post",data:s,contentType:"application/x-www-form-urlencoded"}).done(()=>{P.ajax.reload(),L(response.message,response.success)}).fail((l,d,p)=>{console.error("Error editing note:",d,p,l.responseText),alert("Failed to edit note. Please try again.")}).always(()=>_(j,!1))}$(document).on("click",".note_delete",function(s){s.preventDefault(),confirm("Are you sure you want to delete this log?")&&$.ajax({url:$(this).attr("href"),type:"get"}).done(()=>P.ajax.reload()).fail((l,d,p)=>{console.error("Error deleting item:",d,p,l.responseText)})})}function re(){const u=document.querySelector("#architect-details"),h=document.querySelector("#architect_name"),s=document.querySelector("#contractor-details"),l=document.querySelector("#general_contractor_name"),d=document.querySelector("#awarded_contractor_name");b({fieldName:"#shared_id",fetchUrl:"/user/fetchbypattern",fillFields:[{fieldSelector:"#shared_id",itemKey:"id"}],renderItem:n=>`<div><strong>${n.id}</strong><br>${n.name}</div>`}),u&&h.value.trim()!==""&&(u.open=!0),s&&(l.value.trim()!==""||d.value.trim()!=="")&&(s.open=!0),B&&B.addEventListener("change",()=>{document.querySelector("#form-btn-save-project").disabled=!1,q({unsave:!0,lastChanged:"project"})});const p=document.getElementById("#form-btn-save-project");p&&p.addEventListener("click",async()=>{if(B.checkValidity()){l.value.trim()===""&&(document.querySelector("#general_contractor_id").value=""),d.value.trim()===""&&(document.querySelector("#awarded_contractor_id").value=""),document.querySelector(".loading").style.display="flex",q({unsave:!1});try{const i=await(await fetch(A.action,{method:A.method,body:new URLSearchParams(new FormData(A)),headers:{Accept:"application/json"}})).json();i.success?window.location.href=i.redirect:alert(i.message||"Failed to save project.")}catch(n){console.error("Save failed:",n),alert("An error occurred while saving the project.")}finally{document.querySelector(".loading").style.display="none"}}}),document.querySelectorAll(".delete_pro").forEach(n=>{n.addEventListener("click",async()=>{if(confirm("Are you sure you want to delete this project?")){document.querySelector(".loading").style.display="flex";try{const r=await(await fetch(`/project/${D}/delete`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();r.success?window.location.href="/index/home":alert(r.message||"Failed to delete the project.")}catch(i){console.error("Delete failed:",i),alert("Error occurred while deleting the project.")}finally{document.querySelector(".loading").style.display="none"}}})});let t=$("#architect_name, #architect_id, #architect_company_id, #architect_rep_id, #architect_type_id, #architect_class_id"),e=$("#address_list"),o=$("#address_id, #address_name, #phys_address1, #phys_address2, #phys_city, #phys_state, #phys_postal_code, #phys_country, #central_phone_number, #email_address, #url"),a=$("#specifier_name"),f=$("#specifier_id, #specifier_address_id, #specifier_first_name, #specifier_last_name, #specifier_job_title, #specifier_phone_number, #specifier_email");$("#add_architect").on("click",function(){[t,o,f].forEach(n=>n.val("").prop("readonly",!1)),[e,a].forEach(n=>n.html('<option value="">-- Please search for an architect first --</option>'))}),b({fieldName:"#architect_name",fetchUrl:"/architect",fillFields:[],minLength:2,queryParamName:"search",limitParamName:"limit",renderItem:n=>`
    <div class="autocomplete-item">
      <strong>${n.architect_name}</strong><br>
      <span>${n.architect_rep_id} - ${n.company_id}</span>
    </div>`,extraSelectActions:[n=>{n.architect_id&&(g(n.architect_id),y(n.architect_id),v(n.architect_id))}]});function g(n){n&&$.ajax({url:`/architect/${n}/fetchfull`,dataType:"json",type:"get"}).done(function(i){i?t.each(function(){let r=$(this).attr("id");$(this).val(i[r]||""),$("#architect_company_id").val(i.company_id),$("#architect_name").prop("readonly",!1)}):(t.val("").prop("readonly",!1),console.warn("No architect data found for ID:",n))}).fail(function(i,r,m){console.error("Error fetching architect details:",r,m)})}function y(n){n&&$.ajax({url:`/architect/${n}/address`,dataType:"json",type:"get"}).done(function(i){if(e.empty(),!i||i.length===0){e.html('<option value="">No addresses found, please add.</option>'),o.val("").prop("readonly",!1);return}else $.each(i,function(r,m){e.append('<option value="'+m.address_id+'">'+m.name+"</option>")}),e.append('<option value="new">+ Add New Address</option>'),e.prop("selectedIndex",0),X()}).fail(function(i,r,m){console.error("Error fetching address:",r,m)})}function v(n){n&&$.ajax({url:`/architect/${n}/fetchspecs`,dataType:"json",type:"get"}).done(function(i){if(a.empty(),!i||i.length===0){$("#specifier_name").html('<option value="">No specifiers found, please add.</option>'),f.val("").prop("readonly",!1);return}else $.each(i,function(r,m){a.append('<option value="'+m.specifier_id+'">'+m.first_name+" "+m.last_name+"</option>")}),a.append('<option value="new">+ Add New Specifier</option>'),a.prop("selectedIndex",0),H()}).fail(function(i,r,m){console.error("Error fetching specifier:",r,m)})}$("#specifier_name").on("change",function(){$(this).val()==="new"?(f.val(""),f.prop("readonly",!1)):H()}),$("#address_list").on("change",function(){$(this).val()==="new"?(o.val(""),o.prop("readonly",!1)):X()});function H(){let n=$("#specifier_name").val();!n||n==="new"||$.ajax({url:`/architect/${n}/specinfo`,dataType:"json",type:"get"}).done(function(i){i&&f.each(function(){let r=$(this).attr("id");$(this).val(i[r]||""),$("#specifier_address_id").val(i.address_id),$("#specifier_first_name").val(i.first_name),$("#specifier_last_name").val(i.last_name),$("#specifier_job_title").val(i.job_title),$("#specifier_phone_number").val(i.central_phone_number),$("#specifier_email").val(i.email_address)})}).fail(function(i,r,m){console.error("Error fetching specifier details:",r,m)})}function X(){let n=$("#address_list").val();!n||n==="new"||$.ajax({url:`/architect/${n}/addressinfo`,dataType:"json",type:"get"}).done(function(i){i&&o.each(function(){let r=$(this).attr("id");$(this).val(i[r]||""),$("#address_name").val(i.name)})}).fail(function(i,r,m){console.error("Error fetching specifier details:",r,m)})}[{fieldName:"#general_contractor_name",targetPrefix:"general_contractor"},{fieldName:"#awarded_contractor_name",targetPrefix:"awarded_contractor"}].forEach(({fieldName:n,targetPrefix:i})=>{b({fieldName:n,fetchUrl:"/customer",fillFields:[],minLength:2,queryParamName:"search",limitParamName:"limit",renderItem:r=>`
        <div class="autocomplete-item">
          <strong>${r.customer_id} - ${r.company_id}</strong><br>
          <span>${r.customer_name}</span>
        </div>`,extraSelectActions:[r=>{r.customer_id&&ee(r.customer_id,i)}]})});function ee(n,i){fetch(`/customer/${n}/fetchbyid`).then(r=>r.json()).then(r=>{if(r){const m=document.getElementById(`${i}_id`),K=document.getElementById(`${i}_name`);m&&(m.value=r.customer_id),K&&(K.value=r.customer_name)}}).catch(r=>{console.error(`Failed to fetch contractor (${n}):`,r)})}}const G=$("#dialog-make-quote-form"),z=$("#dialog-make-quote"),C=$("#customer-form-btn-add");$("#customer_id, #customer_name, #company_id, #salesrep_full_name");let W=$("#contact_name");$("#contact_id, #first_name, #last_name, #phys_address1, #phys_address2, #phys_city, #phys_state, #phys_postal_code, #phys_country, #central_phone_number, #email_address");W.data("default-options",W.html());function ce(){const u=document.getElementById("form-btn-save-quote"),h=document.getElementById("quote-content");h&&h.addEventListener("change",()=>{u.disabled=!1,q({unsave:!0,lastChanged:"project"})}),u&&u.addEventListener("click",function(t){t.preventDefault();const e=document.querySelector("form"),o=new Event("submit",{cancelable:!0});e.dispatchEvent(o),q({unsave:!1})}),$(".quote-action-button").on("click",async function(t){var y;t.preventDefault();const e=$(this),o=e.data("action"),a=(y=e.data("label"))==null?void 0:y.toLowerCase();if(!o||["submit","approve","submit-approve"].includes(o)&&!M.validationEngine("validate")||!confirm(`You are about to ${a} this quote. Continue?`))return;e.prop("disabled",!0),q({unsave:!1});let g=M.serialize();$(".loading").show();try{const v=await $.post(`/quote/${R}/${o}`,g);v.success?(window.scrollTo(0,0),location.reload()):alert(v.message||`Failed to ${a} the quote.`)}catch(v){console.error("Submit failed:",v),alert(`Error occurred while trying to ${a} the quote.`)}finally{$(".loading").hide(),setTimeout(()=>e.prop("disabled",!1),1e3)}}),$(".delete_quote").on("click",async function(t){if(t.preventDefault(),confirm("Are you sure you want to delete this quote?")==!0){q({unsave:!1}),$(".loading").show();try{const e=await $.ajax({url:`/quote/${R}/delete`,type:"GET",dataType:"json"});e.success?window.location.href="/index/home":alert(e.message||"Failed to delete the quote.")}catch(e){console.error("Delete failed:",e),alert("Error occurred while deleting the quote.")}finally{$(".loading").hide()}}}),$("a.quote-edit-again").on("click",function(t){confirm("You are about to edit this approved quote. Continue?")==!0?(t.preventDefault(),$(".loading").show(),$.ajax({url:`/quote/${R}/edit`,type:"get",success:function(e){location.reload()}}),$(".loading").hide()):t.preventDefault()}),z.dialog({autoOpen:!1,modal:!0,minWidth:800,width:1200,height:650,open:function(){O(G),$(".ui-widget-overlay").hide().fadeIn().css("z-index",1e3),$(".ui-dialog").css("z-index",2e3)},beforeClose:function(){$(".ui-widget-overlay").fadeOut(400,function(){$(this).remove()})},dialogClass:"add-customer-dialog",buttons:[{id:"customer-form-btn-add",text:"Make Quote",click:function(){G.validationEngine("validate")&&(_(C,!0),p(),$(this).dialog("close"),setTimeout(()=>_(C,!1),1e3))},"aria-label":"Make Quote"},{id:"customer-form-btn-cancel",text:"Cancel",click:function(){$(this).dialog("close")},"aria-label":"Cancel"}]}),$("#widget-btn-add-quote, .make-quote").on("click",function(t){t.preventDefault(),z.dialog("open")});function s(t){const e=t.querySelector("input[id$='_customer_name']"),o=t.dataset.type;b({fieldName:`#${e.id}`,fetchUrl:"/customer",fillFields:[{fieldSelector:`#${o}_customer_id`,itemKey:"customer_id"},{fieldSelector:`#${o}_customer_name`,itemKey:"customer_name"},{fieldSelector:`#${o}_company_id`,itemKey:"company_id"},{fieldSelector:`#${o}_salesrep_full_name`,itemKey:"salesrep_full_name"}],minLength:2,queryParamName:"search",limitParamName:"limit",renderItem:a=>`<div>
        <b>${a.customer_id}</b> - ${a.customer_name} - 
        <small>${a.from_P21}</small>
      </div>`,extraSelectActions:[a=>{a.customer_id&&l(a.customer_id,t)}]})}function l(t,e){t&&fetch(`/customer/${t}/contacts`).then(o=>o.json()).then(o=>{const a=e.querySelector("select[id$='_contact_name']");a&&(a.innerHTML="",o.forEach(f=>{const g=document.createElement("option");g.value=f.contact_id,g.textContent=f.contact_full_name,a.appendChild(g)}),d(e))}).catch(o=>{console.error("Failed to fetch contacts:",o)})}function d(t){const e=t.querySelector("select[id$='_contact_name']"),o=e==null?void 0:e.value;o&&fetch(`/customer/${o}/contactinfo`).then(a=>a.json()).then(a=>{const f=t.dataset.type;["contact_id","first_name","last_name","phys_address1","phys_address2","phys_city","phys_state","phys_postal_code","phys_country","central_phone_number","email_address"].forEach(y=>{const v=document.getElementById(`${f}_${y}`);v&&(v.value=a[y]||"")})}).catch(a=>{console.error("Failed to fetch contact info:",a)})}document.querySelectorAll(".customer-section").forEach(t=>{s(t);const e=t.querySelector("select[id$='_contact_name']");e&&e.addEventListener("change",()=>d(t))});function p(){_(C,!0);let t=$("#dialog_contact_id").val(),e="";x==="project"&&(e=A.serialize()+"&contact_id="+encodeURIComponent(t)+"&project_id="+encodeURIComponent(D)),x==="quote"&&(e="&contact_id="+encodeURIComponent(t)+"&project_id="+encodeURIComponent($("#project_id").val())),$(".loading").show(),$.ajax({url:"/quote",type:"post",data:e,contentType:"application/x-www-form-urlencoded",dataType:"json"}).done(o=>{o.success&&o.quote_id?window.location.href=`/quote/${o.quote_id}/edit`:alert(o.message||"Failed to make quote. Please try again.")}).fail((o,a,f)=>{console.error("Error making quote:",a,f,o.responseText),alert("Failed to make quote. Please try again.")}).always(()=>{_(C,!1),$(".loading").hide()})}}function J(){const u=document.querySelector(".search-architect-button"),h=document.getElementById("search-overlay"),s=document.getElementById("close-search"),l=document.getElementById("architect-search"),d=document.body;u&&u.addEventListener("click",()=>{h.classList.add("active"),d.classList.add("noscroll"),setTimeout(()=>l.focus(),100)});function p(){h.classList.remove("active"),d.classList.remove("noscroll"),setTimeout(()=>l.value="",400)}s&&(s.addEventListener("click",p),document.addEventListener("keydown",t=>{t.key==="Escape"&&p()}))}function Z(){document.querySelectorAll('a.widget-link[href^="#"]').forEach(u=>{u.addEventListener("click",function(h){const s=this.getAttribute("href").substring(1),l=document.getElementById(s);if(l){h.preventDefault();const t=l.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:t,behavior:"smooth"}),setTimeout(()=>{l.classList.add("highlighted"),setTimeout(()=>l.classList.remove("highlighted"),1500)},500)}})})}document.addEventListener("DOMContentLoaded",()=>{Z(),J(),Y(),oe(),ne(),ie(),re(),ce(),ae(),V(),new URLSearchParams(window.location.search).get("open")==="make-quote"&&z.dialog("open"),document.querySelectorAll(".top-level-entry").forEach(s=>{s.addEventListener("click",function(){document.querySelectorAll(".top-level-entry").forEach(l=>l.classList.remove("active")),this.classList.add("active")})})});document.body.addEventListener("htmx:afterSwap",function(u){Z(),(u.target.querySelector("#search-overlay")||u.target.querySelector(".search-architect-button"))&&J(),u.target.id==="content"&&(Y(),setTimeout(V,50))});
