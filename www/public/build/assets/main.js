import k from"https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/module.esm.js";function ce(){return{currentEl:null,hoverEl:null,init(){this.updateUnderline(),document.body.addEventListener("htmx:afterSwap",()=>{this.$nextTick(()=>this.updateUnderline())})},setActive(e){this.currentEl=e.target.closest(".top-level-entry"),this.moveUnderline(this.currentEl)},loadSidebar(e){htmx.ajax("GET",e,{target:"#options-menu-items",swap:"innerHTML"})},setHover(e){this.hoverEl=e.target.closest(".top-level-entry"),this.moveUnderline(this.hoverEl)},clearHover(){if(this.hoverEl=null,this.currentEl)this.moveUnderline(this.currentEl);else{const e=this.$refs.underline;e.style.width="0"}},updateUnderline(){this.currentEl=document.querySelector(".top-level-entry.active"),this.currentEl&&this.moveUnderline(this.currentEl)},moveUnderline(e){if(!e)return;const t=this.$refs.underline,a=e.getBoundingClientRect(),n=e.closest(".nav-wrapper").getBoundingClientRect(),i=a.width,f=a.left-n.left;t.style.transition="width 0.5s cubic-bezier(0.25, 1.5, 0.5, 1), transform 0.5s cubic-bezier(0.25, 1.5, 0.5, 1)",t.style.width=`${i}px`,t.style.transform=`translateX(${f}px)`}}}function w(e,t=!0){const a=t?"success":"error",n=document.createElement("div");n.className=`flash-message widget-table ${a}`,n.innerHTML=`<p>${e}</p>`;const i=document.getElementById("js-flash-container");i&&(i.appendChild(n),n.offsetWidth,n.classList.add("show"),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateY(-10px)",setTimeout(()=>n.remove(),500)},4e3))}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".flash-message");e&&(setTimeout(()=>{e.classList.add("show")},300),setTimeout(()=>{e.style.opacity="0",e.style.transform="translateY(-10px)",setTimeout(()=>e.remove(),500)},4e3))});function de(){return{loading:!1,requestCount:0,timeoutId:null,errorMessage:"",init(){document.body.addEventListener("htmx:beforeRequest",()=>{this.requestCount++,this.loading=!0,this.errorMessage="",this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.requestCount=0,this.loading=!1,this.errorMessage="Request timed out. Please try again."},1e4)});const e=()=>{this.requestCount=Math.max(0,this.requestCount-1),this.requestCount===0&&(this.loading=!1,this.timeoutId&&clearTimeout(this.timeoutId))},t=(a="Something went wrong. Please try again.")=>{w(a,!1)};document.body.addEventListener("htmx:afterSwap",()=>{e()}),document.body.addEventListener("htmx:responseError",()=>{e(),t()}),document.body.addEventListener("htmx:sendError",()=>{e(),t()}),document.body.addEventListener("htmx:timeout",()=>{e(),this.errorMessage="Request timed out. Please try again."})}}}const S=window.location.pathname.split("/")[2],U=window.location.pathname.split("/")[2],I=window.location.pathname.split("/")[2],q=window.location.pathname.split("/")[1],X=$("#project_content"),O=document.getElementById("project_content"),K=$("#quote-content");let A,H,te;const G={adminProject:()=>{$("#admin-project-table").DataTable({ajax:{url:"/index/admin/project?view=true",dataSrc:""},processing:!0,responsive:!0,columns:[{data:"project_id",render:function(e){return"<a target='_blank' href='/project/"+e+"/edit'>"+e+"</a>"}},{data:"project_id_ext"},{data:"project_name"},{data:"owner_id"},{data:"shared_id"},{data:"create_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"due_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"architect_name"},{data:"market_segment_desc"},{data:"status_desc"},{data:"project_id",render:function(e){return'<a target="_blank" href="/project/'+e+'/edit?open=make-quote"><span class="button-wrap"><span class="icon icon-money"></span></span></a>'}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,1,3,4,5,6,8,9],className:"dt-body-center"}],order:[[0,"desc"]],fixedColumns:{start:1,end:1},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>All projects</h2>",e},bottomStart:"pageLength"}})},adminQuote:()=>{$("#admin-quote-table").DataTable({ajax:{url:"/index/admin/quote?view=true",dataSrc:""},processing:!0,responsive:!0,columns:[{data:"quote_id",render:function(e,t,a,n){return"<a target='_blank' href='/quote/"+e+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"market_segment_desc"},{data:"quote_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"expire_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"ship_required_date.date",render:function(e){return e?"<p>"+new Date(e).toLocaleDateString("en-CA")+"</p>":"<p>--</p>"}},{data:"project_status"},{data:"quote_status_id",render:function(e){return e==4?'<span class="disapproved red">Disapproved</span>':e==3?'<span class="approved green">Approved</span>':e==2?'<span class="waiting orange">Waiting</span>':"Not submitted"}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,4,5,6,7],className:"dt-body-center"}],order:[[0,"desc"]],fixedColumns:{start:1,end:1},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>All quotes</h2>",e},bottomStart:"pageLength"}})},homeOwnProject:()=>{$("#dashboard-home-own-table").DataTable({ajax:{url:"/index/home/own?view=true",dataSrc:""},processing:!0,columns:[{data:"project_id_ext",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+a.project_id+"/edit' title='Edit project "+a.project_id+"'>"+e+"</a>"}},{data:"project_name"},{data:"shared_id"},{data:"market_segment_desc"},{data:"architect_name"},{data:"quote_count"},{data:"create_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"due_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"status_desc"},{data:"project_id",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+e+"/edit?open=make-quote'><span class='button-wrap'><span class='icon icon-money'></span></span></a>"}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,5,6,7,8],className:"dt-body-center"}],order:{name:"project_id",dir:"desc"},fixedColumns:{start:1,end:2},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>My Projects</h2><p>"+ownTableCount+" projects",e},bottomStart:"pageLength"}})},homeSharedProject:()=>{$("#dashboard-home-assigned-table").DataTable({ajax:{url:"/index/home/assigned",dataSrc:""},columns:[{data:"project_id_ext",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+a.project_id+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"owner_id"},{data:"market_segment_desc"},{data:"architect_name"},{data:"quote_count"},{data:"create_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"due_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"status_desc"},{data:"project_id",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+e+"/edit?open=make-quote'><span class='button-wrap'><span class='icon icon-money'></span></span></a>"}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,5,6,7,8],className:"dt-body-center"}],processing:!0,order:{name:"project_id",dir:"desc"},fixedColumns:{start:1,end:2},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>Shared Projects</h2>"+assignTableCount+" shared projects",e},bottomStart:"pageLength"}})},homeOtherProject:()=>{$("#dashboard-home-other-table").DataTable({ajax:{url:"/index/home/other",dataSrc:""},columns:[{data:"project_id_ext",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+a.project_id+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"owner_id"},{data:"shared_id"},{data:"market_segment_desc"},{data:"architect_name"},{data:"quote_count"},{data:"create_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"due_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"status_desc"},{data:"project_id",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+e+"/edit?open=make-quote'><span class='button-wrap'><span class='icon icon-money'></span></span></a>"}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,4,6,7,8],className:"dt-body-center"}],processing:!0,order:{name:"project_id",dir:"desc"},fixedColumns:{start:1,end:2},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>Other Projects At <?= $company ?></h2><p>"+otherTableCount+" projects at <?= $company ?>",e},bottomStart:"pageLength"}})},homeQuote:()=>{$("#dashboard-home-quote-table").DataTable({ajax:{url:"/index/home/quote",dataSrc:""},processing:!0,responsive:!0,columns:[{data:"quote_id",render:function(e,t,a,n){return"<a target='_blank' href='/quote/"+e+"/edit'>"+e+"</a>"}},{data:"project_id",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+e+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"quote_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"expire_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"ship_required_date.date",render:function(e){return e?"<p>"+new Date(e).toLocaleDateString("en-CA")+"</p>":"<p>--</p>"}},{data:"customer_name"},{data:"project_status"},{data:"quote_status_id",render:function(e){return e==4?'<span class="disapproved red">Disapproved</span>':e==3?'<span class="approved green">Approved</span>':e==2?'<span class="waiting orange">Waiting</span>':"Not submitted"}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,1,3,4,5,7,8],className:"dt-body-center"}],order:[[0,"desc"]],fixedColumns:{start:2,end:2},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>My Quotes</h2>"+quoteTableCount+" quotes",e},bottomStart:"pageLength"}})},homeNote:()=>{$("#dashboard-home-note-table").DataTable({ajax:{url:"/index/home/note",dataSrc:""},processing:!0,responsive:!0,columns:[{data:"date_added.date",render:function(e){return"<p><b>"+new Date(e).toLocaleDateString("en-CA")+"</b></p>"}},{data:"project_id",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+a.project_id+"/edit'>"+a.project_id+"</a>"}},{data:"project_name"},{data:"next_action",render:function(e){return"<p>"+e.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</p>"}}],columnDefs:[{targets:[0,1,2,3],className:"dt-head-center"},{targets:[0,1],className:"dt-body-center"}],fixedColumns:{},scrollX:!0,order:[[0,"desc"]],layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>Follow Up Notes</h2>"+noteTableCount+" notes",e},bottomStart:"pageLength"}})},approvalWaiting:()=>{$("#dashboard-approve-waiting-table").DataTable({ajax:{url:"/index/approval/waiting",dataSrc:""},processing:!0,responsive:!0,columns:[{data:"quote_id",render:function(e,t,a,n){return"<a target='_blank' href='/quote/"+e+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"architect_rep_id"},{data:"customer_name"},{data:"owner_name"},{data:"market_segment_desc"},{data:"quote_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"ship_required_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"quote_status"}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,4,5,6,7,8],className:"dt-body-center"}],order:[[0,"desc"]],fixedColumns:{start:1,end:1},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>Waiting for Approval</h2>",e},bottomStart:"pageLength"}})},approvalApproved:()=>{$("#dashboard-approve-approved-table").DataTable({ajax:{url:"/index/approval/approved",dataSrc:""},processing:!0,columns:[{data:"quote_id",render:function(e){return"<a target='_blank' href='/quote/"+e+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"architect_name"},{data:"customer_name"},{data:"owner_name"},{data:"market_segment_desc"},{data:"quote_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"expire_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"ship_required_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"quote_status"},{data:"order_no"}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,4,5,6,7,8,9,10],className:"dt-body-center"}],order:[[0,"desc"]],fixedColumns:{start:1,end:1},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>Approved</h2>",e},bottomStart:"pageLength"}})},approvalDisapproved:()=>{$("#dashboard-approve-disapproved-table").DataTable({ajax:{url:"/index/approval/disapproved",dataSrc:""},responsive:!0,processing:!0,columns:[{data:"quote_id",render:function(e,t,a,n){return"<a target='_blank' href='/quote/"+e+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"architect_name"},{data:"customer_name"},{data:"owner_name"},{data:"market_segment_desc"},{data:"quote_date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"expire_date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"ship_required_date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"quote_status"},{data:"quote_id",render:function(e,t,a,n){return"<a target='_blank' href='/quote/edit/id/"+a.quote_id+"'><span class='button-wrap'><span class='icon icon-edit'></span></span></a>"}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,4,5,6,7,8,9,10],className:"dt-body-center"}],order:[[0,"desc"]],fixedColumns:{start:1,end:1},scrollX:!0,layout:{topStart:function(){let e=document.createElement("div");return e.innerHTML="<h2>Disapproved</h2>",e},bottomStart:"pageLength"}})},architectAll:()=>{new DataTable("#architect-all-table",{ajax:{url:"/index/architect/all",dataSrc:""},processing:!0,responsive:!0,columns:[{data:"architect_id",render:function(e,t,a,n){return"<a target='_blank' href='/architect/"+a.architect_id+"/edit'>"+e+"</a>"}},{data:"architect_name"},{data:"architect_rep_id"},{data:"architect_type_desc"},{data:"class_id"},{data:"project_count"},{data:"quote_count"},{data:"date_added.date",render:function(e){return new Date(e).toLocaleDateString()}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,4,5,6],className:"dt-body-center"}],order:[[0,"desc"]],fixedColumns:{start:1,end:1},scrollX:!0,layout:{topStart:null,topEnd:null,bottomStart:"search"}})},architectTop5:()=>{new DataTable("#top-5-architect-table",{ajax:{url:"/index/architect/topfive",dataSrc:""},processing:!0,responsive:!0,columns:[{data:"architect_name",render:function(e,t,a){return"<a target='_blank' href='/architect/"+a.architect_id+"/edit'>"+e+"</a>"}},{data:"total_projects"}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0],className:"dt-body-center"}],order:{name:"total_projects",dir:"desc"},scrollX:!0,layout:{topStart:null,topEnd:null,bottomStart:null,bottomEnd:null}})},projectNote:()=>{A=$("#note-table").DataTable({ajax:{url:`/project/${S}/note`,dataSrc:""},processing:!0,responsive:!0,columns:[{data:"date_added.date",render:function(e){return"<p><b>"+new Date(e).toLocaleDateString("en-CA")+"</b></p>"}},{data:"note_title",render:function(e,t,a,n){if(e=="")return"<p>"+a.project_note.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</p>";if(a.project_note==null)return"<p>"+e+"</p>";{let i=a.project_note.replace(/(?:\r\n|\r|\n)/g,"<br>");return"<p><b>"+e+"</b></br>"+i+"</p>"}}},{data:"next_action",render:function(e){return"<p>"+e.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</p>"}},{data:"follow_up_date.date",render:function(e,t,a){const n=a.notified_flag==="Y";if(!e)return"--";let i=new Date(e).toLocaleString("en-CA");return n?`<span title="Reminder already sent">${i} <span class="tag tag-sent">Sent</span></span>`:i}},{data:"owner_id",render:function(e){return e!=null?"<p><b>"+e+"</b></p>":e}},{data:"project_note_id",render:function(e,t,a){if(!isOwner)return null;const n=a.notified_flag==="Y",i=[];return n||i.push(`
                <a href="#" title="Edit this note" class="note-edit" data-id="${e}">
                  <span class="button-wrap">
                    <span class="icon icon-edit"></span>
                  </span>
                </a>
              `),i.push(`
              <a href="#" title="Delete this note" class="note-delete" data-id="${e}">
                <span class="button-wrap">
                  <span class="icon icon-delete"></span>
                </span>
              </a>
            `),`<div class="row-button">${i.join("")}</div>`}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,3,4,5],className:"dt-body-center"}],order:[[0,"desc"]],scrollX:!0,fixedColumns:{end:1}})},item:()=>{H=$("#item-table").DataTable({ajax:{url:"/item/table",data:{id:S,type:q},dataSrc:""},processing:!0,columns:[{data:"item_id",render:function(e,t,a,n){return'<b class="item-name">'+e+"</b><br>"+a.item_desc}},{data:"quantity",render:function(e){return"<b>"+Number.parseFloat(e).toFixed(0)+"</b>"}},{data:"unit_price",render:function(e){return"<b>"+e+"</b>"}},{data:"uom",render:function(e){return"<b>"+e+"</b>"}},{data:"subtotal",render:function(e){return"<b>"+e+"</b>"}},{data:"note",render:function(e){return"<p>"+e.replace(/(?:\r\n|\r|\n)/g,"<br>")+"</p>"}},{data:"item_uid",render:function(e){return'<div class="row-button"><a title="Edit this item" class="item-edit" href="/item/fetch?uid='+e+"&type="+q+'"><span class="button-wrap"><span class="icon icon-edit"></span></span></a><a title="Delete this item" class="item_delete" href="/item/delete?uid='+e+"&type="+q+'"><span class="button-wrap"><span class="icon icon-delete"></span></span></a></div>'}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,1,2,3,4],className:"dt-body-center"}],layout:{topStart:null,topEnd:null},order:[[7,"desc"]],paging:!1,scrollX:!0,fixedColumns:{start:1,end:1}})},projectQuote:()=>{$("#project-quote-table").DataTable({ajax:{url:`/project/${S}/quotetable`,dataSrc:""},processing:!0,responsive:!0,columns:[{data:"quote_id",render:function(e,t,a,n){return"<a target='_blank' href='/quote/"+e+"/edit'>"+e+"</a>"}},{data:"customer_name"},{data:"contact_full_name"},{data:"quote_date.date",render:function(e){return new Date(e).toLocaleDateString()}},{data:"expire_date.date",render:function(e){let t=new Date(e);return t<=new Date?'<span class="red">'+t.toLocaleDateString()+"</span>":t.toLocaleDateString()}},{data:"ship_required_date.date",render:function(e){return e?"<p>"+new Date(e).toLocaleDateString("en-CA")+"</p>":"<p>--</p>"}},{data:"quote_status",render:function(e){return e=="Dissapproved"?'<span class="disapproved red">Disapproved</span>':e=="Approved"?'<span class="approved green">Approved</span>':e=="Waiting"?'<span class="waiting orange">Waiting</span>':"Draft"}},{data:"order_no"}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2,3,4,5,6,7],className:"dt-body-center"}],order:[[0,"desc"]],scrollX:!0,layout:{topStart:null,topEnd:null}})},architectProjects:()=>{te=new DataTable("#architect-projects-table",{ajax:{url:`/architect/${I}/projects`,dataSrc:""},processing:!0,columns:[{data:"project_id",render:function(e,t,a,n){return"<a target='_blank' href='/project/"+e+"/edit'>"+e+"</a>"}},{data:"project_name"},{data:"quote_count"},{data:"status_desc"}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0,2],className:"dt-body-center"}],scrollX:!0,fixedColumns:{start:1,end:2},order:[[0,"desc"]],layout:{topStart:null,topEnd:null,bottomStart:null,bottomEnd:null}})},architectAddresses:()=>{new DataTable("#architect-addresses-table",{ajax:{url:`/architect/${I}/address`,dataSrc:""},processing:!0,responsive:!0,columns:[{data:"address_id",render:function(e,t,a,n){return"<a target='_blank' href='/architect/"+e+"/edit'>"+e+"</a>"}},{data:"name"}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0],className:"dt-body-center"}],order:[[0,"desc"]],layout:{topStart:null,topEnd:null,bottomStart:null,bottomEnd:null}})},architectSpecifiers:()=>{new DataTable("#architect-specifiers-table",{ajax:{url:`/architect/${I}/fetchspecs`,dataSrc:""},processing:!0,responsive:!0,columns:[{data:"specifier_id",render:function(e,t,a,n){return"<a target='_blank' href='/architect/"+e+"/edit'>"+e+"</a>"}},{data:"first_name",render:function(e,t,a,n){return`${e} ${a.last_name}`}}],columnDefs:[{targets:"_all",className:"dt-head-center"},{targets:[0],className:"dt-body-center"}],order:[[0,"desc"]],layout:{topStart:null,topEnd:null,bottomStart:null,bottomEnd:null}})}};function ae(){$(".sTable").each(function(){const e=$(this),t=e.data("init");if(!t||!(t in G)){console.warn(`No DataTable config found for: ${t}`);return}$.fn.DataTable.isDataTable(e)&&e.DataTable().destroy(),G[t]()})}function L(e){e&&(e.querySelectorAll("input[type='hidden'], input[type='text'], input[type='password'], input[type='file'], select, textarea").forEach(t=>{t.value="",t.dispatchEvent(new Event("change",{bubbles:!0}))}),e.querySelectorAll("input[type='checkbox'], input[type='radio']").forEach(t=>{t.checked=!1,t.dispatchEvent(new Event("change",{bubbles:!0}))}),e.querySelectorAll("select").forEach(t=>{const a=t.dataset.defaultOptions;a&&(t.innerHTML=a),t.selectedIndex=0,t.dispatchEvent(new Event("change",{bubbles:!0}))}),e.querySelectorAll("input, select, textarea").forEach(t=>{t.disabled=!1}))}function b(e,t){e.prop("disabled",t)}function le(){flatpickr(".flatpickr",{dateFormat:"Y-m-d"}),flatpickr(".flatpickr-time",{enableTime:!0,dateFormat:"Y-m-d H:i"})}function ne(){const e=document.querySelectorAll(".fade-in-up:not(.show)");if(!("IntersectionObserver"in window)){e.forEach(a=>a.classList.add("show"));return}const t=new IntersectionObserver((a,n)=>{a.forEach(i=>{i.isIntersecting&&(i.target.classList.add("show"),n.unobserve(i.target))})},{threshold:.1});e.forEach(a=>t.observe(a))}function ue(){return{open:!1,projectName:"",projectDescription:"",architectId:I,async submitForm(){const e=document.getElementById("architect-edit-project-form"),t=new FormData(e),a=document.getElementById("owner_id");a&&t.append("owner_id",a.value),t.append("architect_id",this.architectId);try{const i=await(await fetch("/project",{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest"}})).json();i.success?(w(i.message,i.success),te.ajax.reload(),L(),this.open=!1):w(i.message,i.success)}catch(n){alert("Error submitting form."),console.error(n)}},closeModal(){const e=document.getElementById("architect-edit-project-form");L(e),this.projectName="",this.projectDescription="",this.open=!1}}}function pe(){const e=document.getElementById("dialog-note-form");return{open:!1,async submitForm(){const t=new FormData(e);t.append("project_id",S);const a=e.note_id.value,n=!!a;try{const f=await(await fetch(n?`/note/${a}/edit`:"/note",{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest"}})).json();f.success?(w(f.message,f.success),A.ajax.reload(),L(),this.open=!1):w(f.message,f.success)}catch(i){alert("Error submitting form."),console.error(i)}},async editNote(t){try{const n=await(await fetch(`/note/${t}/edit`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();if(n&&n.note){e.note_title.value=n.note.note_title,e.project_note.value=n.note.project_note,e.next_action.value=n.note.next_action||"";const i=document.getElementById("follow_up_date")._flatpickr;i&&n.note.follow_up_date&&i.setDate(n.note.follow_up_date.date),e.note_id.value=t,this.open=!0}else alert("Note not found.")}catch(a){console.error("Error loading note:",a),alert("Failed to load note.")}},closeModal(){L(e),this.open=!1}}}function me(){window.Alpine=k,document.addEventListener("alpine:init",()=>{k.data("navUnderline",ce),k.data("loadingState",de),k.data("projectModal",ue),k.data("noteModal",pe)}),k.start()}function oe(){const e=document.querySelector(".search-architect-button"),t=document.getElementById("search-overlay"),a=document.getElementById("close-search"),n=document.getElementById("architect-search"),i=document.body;e&&e.addEventListener("click",()=>{t.classList.add("active"),i.classList.add("noscroll"),setTimeout(()=>n.focus(),100)});function f(){t.classList.remove("active"),i.classList.remove("noscroll"),setTimeout(()=>n.value="",400)}a&&(a.addEventListener("click",f),document.addEventListener("keydown",l=>{l.key==="Escape"&&f()}))}function re(){document.querySelectorAll('a.widget-link[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){const a=this.getAttribute("href").substring(1),n=document.getElementById(a);if(n){t.preventDefault();const l=n.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:l,behavior:"smooth"}),setTimeout(()=>{n.classList.add("highlighted"),setTimeout(()=>n.classList.remove("highlighted"),1500)},500)}})})}function N({fieldName:e,fetchUrl:t,fillFields:a=[],renderItem:n=defaultRenderItem,extraSelectActions:i=[],minLength:f=1,queryParamName:l="pattern",limitParamName:o="limit"}){const r=document.querySelector(e);if(!r||r.classList.contains("no-autocomplete"))return;const u=r.closest(".overlay-style"),p=u?r.parentNode.querySelector(".autocomplete-list"):document.createElement("ul");u||(p.classList.add("autocomplete-list"),document.body.appendChild(p)),r.parentNode.style.position="relative";let h=-1,y=null;r.addEventListener("input",function(){clearTimeout(y),y=setTimeout(()=>{const g=r.value.trim();if(h=-1,g.length<f)return;const v=`${t}?${l}=${encodeURIComponent(g)}&${o}=10`;fetch(v).then(c=>c.json()).then(c=>{if(p.classList.add("visible"),p.innerHTML="",u&&u.classList.add("fly-up"),!c.length){const d=document.createElement("li");d.textContent="No matches found.",d.classList.add("no-result"),p.appendChild(d);return}c.forEach((d,m)=>{const _=document.createElement("li");_.innerHTML=n(d),_.setAttribute("data-index",m),_.addEventListener("click",function(){a.forEach(({fieldSelector:x,itemKey:Q})=>{const Y=document.querySelector(x);Y&&d[Q]!==void 0&&(Y.value=d[Q])}),i.forEach(x=>{typeof x=="function"&&x(d)}),p.classList.remove("visible"),p.innerHTML="",u&&u.classList.remove("fly-up")}),p.appendChild(_)}),T()}).catch(c=>{p.innerHTML="",console.error("Autocomplete fetch error:",c)})},300)}),r.addEventListener("keydown",function(g){const v=p.querySelectorAll("li:not(.no-result)");v.length&&(g.key==="ArrowDown"?(g.preventDefault(),h=(h+1)%v.length,j(v)):g.key==="ArrowUp"?(g.preventDefault(),h=(h-1+v.length)%v.length,j(v)):g.key==="Enter"?(g.preventDefault(),h>-1&&v[h].click()):g.key==="Escape"&&(p.innerHTML="",u&&u.classList.remove("fly-up")))}),document.addEventListener("click",function(g){p&&g.target!==r&&!p.contains(g.target)&&(p.innerHTML="",u&&u.classList.remove("fly-up"))}),window.addEventListener("scroll",()=>{document.activeElement===r&&T()},!0),window.addEventListener("resize",()=>{document.activeElement===r&&T()});function j(g){g.forEach(v=>v.classList.remove("active")),h>-1&&g[h]&&(g[h].classList.add("active"),g[h].scrollIntoView({block:"nearest"}))}function T(){if(u)return;const g=r.getBoundingClientRect(),v=r.classList.contains("reverse-autocomplete");p.style.position="absolute",p.style.left=`${g.left+window.scrollX}px`,p.style.width=`${g.width}px`,p.style.zIndex="10000",v?p.style.top=`${g.top+window.scrollY-p.offsetHeight}px`:p.style.top=`${g.bottom+window.scrollY}px`}}let M=!1;const P=$("#dialog-item"),W=$("#dialog-item-form"),D=$("#item-form-btn-add"),F=$("#uom");F.data("default-options",F.html());function fe(){const e=document.getElementById("uom"),t=document.getElementById("dialog-item-form");$(document).on("click","a.item-edit",function(o){o.preventDefault(),M=!0,P.dialog("option","title","Edit Item"),P.dialog("open"),D.text("Save Changes"),$.ajax({url:$(this).attr("href"),type:"GET",dataType:"json"}).done(r=>{if(r.success&&r.data){const s=r.data;$("#dialog-item-form #item_uid").val(s.item_uid||""),$("#dialog-item-form #item_id").val(s.item_id||""),$("#dialog-item-form #quantity").val(s.quantity||""),$("#dialog-item-form #note").val(s.note||""),$("#dialog-item-form #uom").val(s.uom||""),a(s.item_id,s.uom,s.unit_price,s.item_uid)}else alert(r.message||"Failed to fetch item data.")}).fail((r,s,u)=>{console.error("Error deleting item:",s,u,r.responseText)})}),$("#widget-btn-add-item").on("click",function(){M=!1,P.dialog("option","title","Add Item"),P.dialog("open"),D.text("Add Item")}),$("#dialog-item").dialog({autoOpen:!1,modal:!0,minWidth:800,width:800,open:function(){L(t),$(".ui-widget-overlay").hide().fadeIn().css("z-index",1e3),$(".ui-dialog").css("z-index",2e3)},beforeClose:function(){$(".ui-widget-overlay").fadeOut(400,function(){$(this).remove()})},dialogClass:"add-item-dialog",buttons:[{id:"item-form-btn-add",text:"Save",click:function(){W.validationEngine("validate")&&(b(D,!0),M?l():f(),$(this).dialog("close"),setTimeout(()=>b(D,!1),1e3))},"aria-label":"Add Item"},{id:"item-form-btn-cancel",text:"Cancel",click:function(){$(this).dialog("close")},"aria-label":"Cancel"}]}),document.querySelector(".dialog #item_id")&&N({fieldName:".dialog #item_id",fetchUrl:"/item/index",fillFields:[{fieldSelector:"#item_id",itemKey:"item_id"},{fieldSelector:"#item_input",itemKey:"item_desc"}],minLength:2,queryParamName:"term",limitParamName:"limit",renderItem:o=>`
      <div class="autocomplete-item">
        <strong>${o.item_id}</strong><br>
        <span>${o.item_desc}</span>
      </div>`,extraSelectActions:[o=>{o.item_id&&(a(o.item_id),e.disabled=!1,e.classList.remove("disabled"))}]}),F.on("change",function(){n($("#item_id").val(),$("#uom").val())});function a(o,r=null,s=null,u=null){o&&$.ajax({url:"/item/uom",dataType:"json",data:{term:o},type:"get"}).done(function(p){F.empty(),$.each(p,function(h,y){let j=$("<option></option>").attr("value",y.uom).text(y.uom);r&&y.uom===r&&j.attr("selected","selected"),F.append(j)}),M?i(u,q):n(o,r||$("#uom").val(),s)}).fail((p,h,y)=>{console.error("Error fetching specifier:",h,y)})}function n(o,r,s=null){!o||!r||$.ajax({url:"/item/price",data:{item_id:o,uom:r},dataType:"json"}).done(u=>{$("#unit_price").val((u==null?void 0:u.price)||s||"")}).fail((u,p,h)=>{console.error("Error fetching price:",p,h)})}function i(o,r){o&&$.ajax({url:"/item/quotedprice",data:{item_uid:o,type:r},dataType:"json"}).done(s=>{$("#unit_price").val((s==null?void 0:s.unit_price)||"")}).fail((s,u,p)=>{console.error("Error fetching price:",u,p)})}function f(){b(D,!0);let o=W.serialize()+"&project_id="+encodeURIComponent(S)+"&type="+encodeURIComponent(q);$.ajax({url:"/item/add",type:"post",data:o,contentType:"application/x-www-form-urlencoded"}).done(r=>{H.ajax.reload(),w(r.message,r.success)}).fail((r,s,u)=>{console.error("Error adding item:",s,u,r.responseText),alert("Failed to add item. Please try again.")}).always(()=>b(D,!1))}function l(){b(D,!0);let o=W.serialize()+"&type="+encodeURIComponent(q);$.ajax({url:"/item/edit",type:"post",data:o,contentType:"application/x-www-form-urlencoded"}).done(r=>{H.ajax.reload(),w(r.message,r.success)}).fail((r,s,u)=>{console.error("Error adding item:",s,u,r.responseText),alert("Failed to edit item. Please try again.")}).always(()=>b(D,!1))}$(document).on("click",".item_delete",function(o){o.preventDefault(),confirm("Are you sure you want to delete this item?")&&$.ajax({url:$(this).attr("href"),type:"GET"}).done(()=>H.ajax.reload()).fail((r,s,u)=>{console.error("Error deleting item:",s,u,r.responseText)})})}const R=$("#dialog-note-form"),V=$("#dialog-message"),C=$("#note-form-btn-add");let J=!1;document.getElementById("follow_up_date");function he(){$("#dialog-message").dialog({autoOpen:!1,modal:!0,minWidth:800,width:1e3,height:650,open:function(){L(R),$(".ui-widget-overlay").hide().fadeIn().css("z-index",1e3),$(".ui-dialog").css("z-index",2e3)},beforeClose:function(){$(".ui-widget-overlay").fadeOut(400,function(){$(this).remove()})},dialogClass:"add-note-dialog",buttons:[{id:"note-form-btn-add",text:"Add Log",click:function(){R.validationEngine("validate")&&(J?t():e(),$(this).dialog("close"),setTimeout(()=>b(C,!1),1e3))},"aria-label":"Add Log"},{id:"note-form-btn-cancel",text:"Cancel",click:function(){$(this).dialog("close")},"aria-label":"Cancel"}]}),document.addEventListener("click",function(a){if(a.target.closest(".note-edit")){a.preventDefault();const n=a.target.closest(".note-edit").dataset.id;window.noteModalComponent&&n&&window.noteModalComponent.editNote(n)}}),$("#widget-btn-add-note").on("click",function(){J=!1,V.dialog("option","title","Add Log"),V.dialog("open"),C.text("Add Note")});function e(){b(C,!0);let a=R.serialize()+"&project_id="+encodeURIComponent(S);$.ajax({url:"/note/add",type:"post",data:a,contentType:"application/x-www-form-urlencoded"}).done(n=>{A.ajax.reload(),w(n.message,n.success)}).fail((n,i,f)=>{console.error("Error adding note:",i,f,n.responseText),alert("Failed to add note. Please try again.")}).always(()=>b(C,!1))}function t(){b(C,!0);let a=R.serialize();$.ajax({url:"/note/edit",type:"post",data:a,contentType:"application/x-www-form-urlencoded"}).done(()=>{A.ajax.reload(),w(response.message,response.success)}).fail((n,i,f)=>{console.error("Error editing note:",i,f,n.responseText),alert("Failed to edit note. Please try again.")}).always(()=>b(C,!1))}document.addEventListener("click",async function(a){const n=a.target.closest(".note-delete");if(n){a.preventDefault();const i=n.dataset.id;if(!i||!confirm("Are you sure you want to delete this note?"))return;try{const o=await(await fetch(`/note/${i}/delete`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}})).json();o.success?(w(o.message,o.success),A.ajax.reload()):w(o.message||o.success)}catch(l){alert("Error deleting note."),console.error(l)}}})}const ie={unsave:!1,lastChanged:null},ge=new Set;function _e(){return{...ie}}function E(e){Object.assign(ie,e),ge.forEach(t=>t(_e()))}function ye(){const e=document.querySelector("#architect-details"),t=document.querySelector("#architect_name"),a=document.querySelector("#contractor-details"),n=document.querySelector("#general_contractor_name"),i=document.querySelector("#awarded_contractor_name");N({fieldName:"#shared_id",fetchUrl:"/user/fetchbypattern",fillFields:[{fieldSelector:"#shared_id",itemKey:"id"}],renderItem:c=>`<div><strong>${c.id}</strong><br>${c.name}</div>`}),e&&t.value.trim()!==""&&(e.open=!0),a&&(n.value.trim()!==""||i.value.trim()!=="")&&(a.open=!0),O&&O.addEventListener("change",()=>{document.querySelector("#form-btn-save-project").disabled=!1,E({unsave:!0,lastChanged:"project"})});const f=document.getElementById("#form-btn-save-project");f&&f.addEventListener("click",async()=>{if(O.checkValidity()){n.value.trim()===""&&(document.querySelector("#general_contractor_id").value=""),i.value.trim()===""&&(document.querySelector("#awarded_contractor_id").value=""),document.querySelector(".loading").style.display="flex",E({unsave:!1});try{const d=await(await fetch(X.action,{method:X.method,body:new URLSearchParams(new FormData(X)),headers:{Accept:"application/json"}})).json();d.success?window.location.href=d.redirect:alert(d.message||"Failed to save project.")}catch(c){console.error("Save failed:",c),alert("An error occurred while saving the project.")}finally{document.querySelector(".loading").style.display="none"}}}),document.querySelectorAll(".delete_pro").forEach(c=>{c.addEventListener("click",async()=>{if(confirm("Are you sure you want to delete this project?")){document.querySelector(".loading").style.display="flex";try{const m=await(await fetch(`/project/${S}/delete`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();m.success?window.location.href="/index/home":alert(m.message||"Failed to delete the project.")}catch(d){console.error("Delete failed:",d),alert("Error occurred while deleting the project.")}finally{document.querySelector(".loading").style.display="none"}}})});let l=$("#architect_name, #architect_id, #architect_company_id, #architect_rep_id, #architect_type_id, #architect_class_id"),o=$("#address_list"),r=$("#address_id, #address_name, #phys_address1, #phys_address2, #phys_city, #phys_state, #phys_postal_code, #phys_country, #central_phone_number, #email_address, #url"),s=$("#specifier_name"),u=$("#specifier_id, #specifier_address_id, #specifier_first_name, #specifier_last_name, #specifier_job_title, #specifier_phone_number, #specifier_email");$("#add_architect").on("click",function(){[l,r,u].forEach(c=>c.val("").prop("readonly",!1)),[o,s].forEach(c=>c.html('<option value="">-- Please search for an architect first --</option>'))}),N({fieldName:"#architect_name",fetchUrl:"/architect",fillFields:[],minLength:2,queryParamName:"search",limitParamName:"limit",renderItem:c=>`
    <div class="autocomplete-item">
      <strong>${c.architect_name}</strong><br>
      <span>${c.architect_rep_id} - ${c.company_id}</span>
    </div>`,extraSelectActions:[c=>{c.architect_id&&(p(c.architect_id),h(c.architect_id),y(c.architect_id))}]});function p(c){c&&$.ajax({url:`/architect/${c}/fetchfull`,dataType:"json",type:"get"}).done(function(d){d?l.each(function(){let m=$(this).attr("id");$(this).val(d[m]||""),$("#architect_company_id").val(d.company_id),$("#architect_name").prop("readonly",!1)}):(l.val("").prop("readonly",!1),console.warn("No architect data found for ID:",c))}).fail(function(d,m,_){console.error("Error fetching architect details:",m,_)})}function h(c){c&&$.ajax({url:`/architect/${c}/address`,dataType:"json",type:"get"}).done(function(d){if(o.empty(),!d||d.length===0){o.html('<option value="">No addresses found, please add.</option>'),r.val("").prop("readonly",!1);return}else $.each(d,function(m,_){o.append('<option value="'+_.address_id+'">'+_.name+"</option>")}),o.append('<option value="new">+ Add New Address</option>'),o.prop("selectedIndex",0),T()}).fail(function(d,m,_){console.error("Error fetching address:",m,_)})}function y(c){c&&$.ajax({url:`/architect/${c}/fetchspecs`,dataType:"json",type:"get"}).done(function(d){if(s.empty(),!d||d.length===0){$("#specifier_name").html('<option value="">No specifiers found, please add.</option>'),u.val("").prop("readonly",!1);return}else $.each(d,function(m,_){s.append('<option value="'+_.specifier_id+'">'+_.first_name+" "+_.last_name+"</option>")}),s.append('<option value="new">+ Add New Specifier</option>'),s.prop("selectedIndex",0),j()}).fail(function(d,m,_){console.error("Error fetching specifier:",m,_)})}$("#specifier_name").on("change",function(){$(this).val()==="new"?(u.val(""),u.prop("readonly",!1)):j()}),$("#address_list").on("change",function(){$(this).val()==="new"?(r.val(""),r.prop("readonly",!1)):T()});function j(){let c=$("#specifier_name").val();!c||c==="new"||$.ajax({url:`/architect/${c}/specinfo`,dataType:"json",type:"get"}).done(function(d){d&&u.each(function(){let m=$(this).attr("id");$(this).val(d[m]||""),$("#specifier_address_id").val(d.address_id),$("#specifier_first_name").val(d.first_name),$("#specifier_last_name").val(d.last_name),$("#specifier_job_title").val(d.job_title),$("#specifier_phone_number").val(d.central_phone_number),$("#specifier_email").val(d.email_address)})}).fail(function(d,m,_){console.error("Error fetching specifier details:",m,_)})}function T(){let c=$("#address_list").val();!c||c==="new"||$.ajax({url:`/architect/${c}/addressinfo`,dataType:"json",type:"get"}).done(function(d){d&&r.each(function(){let m=$(this).attr("id");$(this).val(d[m]||""),$("#address_name").val(d.name)})}).fail(function(d,m,_){console.error("Error fetching specifier details:",m,_)})}[{fieldName:"#general_contractor_name",targetPrefix:"general_contractor"},{fieldName:"#awarded_contractor_name",targetPrefix:"awarded_contractor"}].forEach(({fieldName:c,targetPrefix:d})=>{N({fieldName:c,fetchUrl:"/customer",fillFields:[],minLength:2,queryParamName:"search",limitParamName:"limit",renderItem:m=>`
        <div class="autocomplete-item">
          <strong>${m.customer_id} - ${m.company_id}</strong><br>
          <span>${m.customer_name}</span>
        </div>`,extraSelectActions:[m=>{m.customer_id&&v(m.customer_id,d)}]})});function v(c,d){fetch(`/customer/${c}/fetchbyid`).then(m=>m.json()).then(m=>{if(m){const _=document.getElementById(`${d}_id`),x=document.getElementById(`${d}_name`);_&&(_.value=m.customer_id),x&&(x.value=m.customer_name)}}).catch(m=>{console.error(`Failed to fetch contractor (${c}):`,m)})}}const Z=$("#dialog-make-quote-form"),z=$("#dialog-make-quote"),B=$("#customer-form-btn-add");$("#customer_id, #customer_name, #company_id, #salesrep_full_name");let ee=$("#contact_name");$("#contact_id, #first_name, #last_name, #phys_address1, #phys_address2, #phys_city, #phys_state, #phys_postal_code, #phys_country, #central_phone_number, #email_address");ee.data("default-options",ee.html());function ve(){const e=document.getElementById("form-btn-save-quote"),t=document.getElementById("quote-content");t&&t.addEventListener("change",()=>{e.disabled=!1,E({unsave:!0,lastChanged:"project"})}),e&&e.addEventListener("click",function(l){l.preventDefault();const o=document.querySelector("form"),r=new Event("submit",{cancelable:!0});o.dispatchEvent(r),E({unsave:!1})}),$(".quote-action-button").on("click",async function(l){var h;l.preventDefault();const o=$(this),r=o.data("action"),s=(h=o.data("label"))==null?void 0:h.toLowerCase();if(!r||["submit","approve","submit-approve"].includes(r)&&!K.validationEngine("validate")||!confirm(`You are about to ${s} this quote. Continue?`))return;o.prop("disabled",!0),E({unsave:!1});let p=K.serialize();$(".loading").show();try{const y=await $.post(`/quote/${U}/${r}`,p);y.success?(window.scrollTo(0,0),location.reload()):alert(y.message||`Failed to ${s} the quote.`)}catch(y){console.error("Submit failed:",y),alert(`Error occurred while trying to ${s} the quote.`)}finally{$(".loading").hide(),setTimeout(()=>o.prop("disabled",!1),1e3)}}),$(".delete_quote").on("click",async function(l){if(l.preventDefault(),confirm("Are you sure you want to delete this quote?")==!0){E({unsave:!1}),$(".loading").show();try{const o=await $.ajax({url:`/quote/${U}/delete`,type:"GET",dataType:"json"});o.success?window.location.href="/index/home":alert(o.message||"Failed to delete the quote.")}catch(o){console.error("Delete failed:",o),alert("Error occurred while deleting the quote.")}finally{$(".loading").hide()}}}),$("a.quote-edit-again").on("click",function(l){confirm("You are about to edit this approved quote. Continue?")==!0?(l.preventDefault(),$(".loading").show(),$.ajax({url:`/quote/${U}/edit`,type:"get",success:function(o){location.reload()}}),$(".loading").hide()):l.preventDefault()}),z.dialog({autoOpen:!1,modal:!0,minWidth:800,width:1200,height:650,open:function(){L(Z),$(".ui-widget-overlay").hide().fadeIn().css("z-index",1e3),$(".ui-dialog").css("z-index",2e3)},beforeClose:function(){$(".ui-widget-overlay").fadeOut(400,function(){$(this).remove()})},dialogClass:"add-customer-dialog",buttons:[{id:"customer-form-btn-add",text:"Make Quote",click:function(){Z.validationEngine("validate")&&(b(B,!0),f(),$(this).dialog("close"),setTimeout(()=>b(B,!1),1e3))},"aria-label":"Make Quote"},{id:"customer-form-btn-cancel",text:"Cancel",click:function(){$(this).dialog("close")},"aria-label":"Cancel"}]}),$("#widget-btn-add-quote, .make-quote").on("click",function(l){l.preventDefault(),z.dialog("open")});function a(l){const o=l.querySelector("input[id$='_customer_name']"),r=l.dataset.type;N({fieldName:`#${o.id}`,fetchUrl:"/customer",fillFields:[{fieldSelector:`#${r}_customer_id`,itemKey:"customer_id"},{fieldSelector:`#${r}_customer_name`,itemKey:"customer_name"},{fieldSelector:`#${r}_company_id`,itemKey:"company_id"},{fieldSelector:`#${r}_salesrep_full_name`,itemKey:"salesrep_full_name"}],minLength:2,queryParamName:"search",limitParamName:"limit",renderItem:s=>`<div>
        <b>${s.customer_id}</b> - ${s.customer_name} - 
        <small>${s.from_P21}</small>
      </div>`,extraSelectActions:[s=>{s.customer_id&&n(s.customer_id,l)}]})}function n(l,o){l&&fetch(`/customer/${l}/contacts`).then(r=>r.json()).then(r=>{const s=o.querySelector("select[id$='_contact_name']");s&&(s.innerHTML="",r.forEach(u=>{const p=document.createElement("option");p.value=u.contact_id,p.textContent=u.contact_full_name,s.appendChild(p)}),i(o))}).catch(r=>{console.error("Failed to fetch contacts:",r)})}function i(l){const o=l.querySelector("select[id$='_contact_name']"),r=o==null?void 0:o.value;r&&fetch(`/customer/${r}/contactinfo`).then(s=>s.json()).then(s=>{const u=l.dataset.type;["contact_id","first_name","last_name","phys_address1","phys_address2","phys_city","phys_state","phys_postal_code","phys_country","central_phone_number","email_address"].forEach(h=>{const y=document.getElementById(`${u}_${h}`);y&&(y.value=s[h]||"")})}).catch(s=>{console.error("Failed to fetch contact info:",s)})}document.querySelectorAll(".customer-section").forEach(l=>{a(l);const o=l.querySelector("select[id$='_contact_name']");o&&o.addEventListener("change",()=>i(l))});function f(){b(B,!0);let l=$("#dialog_contact_id").val(),o="";q==="project"&&(o=X.serialize()+"&contact_id="+encodeURIComponent(l)+"&project_id="+encodeURIComponent(S)),q==="quote"&&(o="&contact_id="+encodeURIComponent(l)+"&project_id="+encodeURIComponent($("#project_id").val())),$(".loading").show(),$.ajax({url:"/quote",type:"post",data:o,contentType:"application/x-www-form-urlencoded",dataType:"json"}).done(r=>{r.success&&r.quote_id?window.location.href=`/quote/${r.quote_id}/edit`:alert(r.message||"Failed to make quote. Please try again.")}).fail((r,s,u)=>{console.error("Error making quote:",s,u,r.responseText),alert("Failed to make quote. Please try again.")}).always(()=>{b(B,!1),$(".loading").hide()})}}function be(){const e=document.getElementById("architect-form"),t=document.getElementById("form-btn-save-architect");e&&e.addEventListener("change",()=>{t.disabled=!1,E({unsave:!0,lastChanged:"project"})}),t&&t.addEventListener("click",async function(a){a.preventDefault(),document.querySelector(".loading").style.display="flex";try{const n=new FormData(e),i=e.getAttribute("action"),f=e.getAttribute("method"),o=await(await fetch(i,{method:f,body:n})).json();o.sucess&&(E({unsave:!1}),window.location.href=o.redirect||`/architect/${I}/edit`),w(o.message,o.success)}catch(n){console.error("Error submitting form:",n)}finally{document.querySelector(".loading").style.display="none"}}),N({fieldName:"#architect-search",fetchUrl:"/architect",queryParamName:"search",limitParamName:"limit",fillFields:[],minLength:2,renderItem:a=>`
    <div class="autocomplete-item">
      <strong>${a.architect_id} - ${a.architect_name}</strong><br>
      <span>${a.architect_rep_id} - ${a.company_id}</span>
    </div>`,extraSelectActions:[function(a){document.getElementById("search-overlay").classList.remove("active"),document.body.classList.remove("noscroll"),window.location.href=`/architect/${a.architect_id}/edit`}]}),document.querySelectorAll(".delete-architect-button").forEach(a=>{a.addEventListener("click",async()=>{if(confirm("Are you sure you want to delete this architect? This will delete all associate addresses and specifiers.")){document.querySelector(".loading").style.display="flex";try{const i=await(await fetch(`/architect/${I}/delete`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();i.success?window.location.href="/index/architect":w(i.message||i.success)}catch(n){console.error("Delete failed:",n),alert("Error occurred while deleting the architect.")}finally{document.querySelector(".loading").style.display="none"}}})})}function se(){const e=document.getElementById("architectPieChart");if(e){const t=e.getContext("2d");new Chart(t,{type:"pie",data:{labels:["Residential","Commercial","Industrial","Bank","School"],datasets:[{label:"Architect",data:[12,8,5,7,7],backgroundColor:["#336699","#86BBD8","#2F4858","#9EE493","#DAF7DC"],borderColor:"#fff",borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}}me();document.addEventListener("DOMContentLoaded",()=>{re(),oe(),ae(),le(),fe(),he(),ye(),ve(),be(),se(),ne(),new URLSearchParams(window.location.search).get("open")==="make-quote"&&z.dialog("open"),document.querySelectorAll(".top-level-entry").forEach(a=>{a.addEventListener("click",function(){document.querySelectorAll(".top-level-entry").forEach(n=>n.classList.remove("active")),this.classList.add("active")})})});document.body.addEventListener("htmx:afterSwap",function(e){re(),(e.target.querySelector("#search-overlay")||e.target.querySelector(".search-architect-button"))&&oe(),e.target.id==="content"&&(ae(),se(),setTimeout(ne,50))});
