<?php
$session =  Zend_Registry::get('session');
$project = $this->project;
?>


<!-- Title area -->
<main id="content" class="main-content">
    <div class="middleNav">
        <ul>
            <li class="mUser"><a href="#" title="Share"><span class="users"></span></a>
                <ul class="mSub1">
                    <li><a href="#" title="">Share user</a></li>
                    <li><a href="#" title="">Show Teamworks</a></li>
                </ul>
            </li>

            <li class="mOrders"><a href="#" title="Change Status"><span class="files"></span></a>
                <ul class="mSub4">
                    <li><a href="#" title="">Add</a></li>
                    <li><a href="#" title="">Save</a></li>
                    <li><a href="#" title="">Edit</a></li>
                    <li><a href="#" title="">Delete</a></li>
                </ul>
            </li>
        </ul>
        <div class="clear"></div>
    </div>

    <div class="main-page-content">
        <header class="main-page-content-header">
            <h1>Project Information</h1>
        </header>

        <div class="widget-information">
            <div style="grid-row: 1/1" class="widget-table">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 12.75H8C7.80109 12.75 7.61032 12.671 7.46967 12.5303C7.32902 12.3897 7.25 12.1989 7.25 12C7.25 11.8011 7.32902 11.6103 7.46967 11.4697C7.61032 11.329 7.80109 11.25 8 11.25H19C19.1989 11.25 19.3897 11.329 19.5303 11.4697C19.671 11.6103 19.75 11.8011 19.75 12C19.75 12.1989 19.671 12.3897 19.5303 12.5303C19.3897 12.671 19.1989 12.75 19 12.75Z" />
                    <path d="M19 8.25H8C7.80109 8.25 7.61032 8.17098 7.46967 8.03033C7.32902 7.88968 7.25 7.69891 7.25 7.5C7.25 7.30109 7.32902 7.11032 7.46967 6.96967C7.61032 6.82902 7.80109 6.75 8 6.75H19C19.1989 6.75 19.3897 6.82902 19.5303 6.96967C19.671 7.11032 19.75 7.30109 19.75 7.5C19.75 7.69891 19.671 7.88968 19.5303 8.03033C19.3897 8.17098 19.1989 8.25 19 8.25Z" />
                    <path d="M19 17.25H8C7.80109 17.25 7.61032 17.171 7.46967 17.0303C7.32902 16.8897 7.25 16.6989 7.25 16.5C7.25 16.3011 7.32902 16.1103 7.46967 15.9697C7.61032 15.829 7.80109 15.75 8 15.75H19C19.1989 15.75 19.3897 15.829 19.5303 15.9697C19.671 16.1103 19.75 16.3011 19.75 16.5C19.75 16.6989 19.671 16.8897 19.5303 17.0303C19.3897 17.171 19.1989 17.25 19 17.25Z" />
                    <path d="M5.00002 8.50002C4.87 8.50161 4.74093 8.47783 4.62002 8.43002C4.50052 8.37204 4.3895 8.29802 4.29002 8.21002C4.19734 8.11658 4.12401 8.00576 4.07425 7.88392C4.02448 7.76209 3.99926 7.63163 4.00002 7.50002C4.0037 7.23525 4.10728 6.98165 4.29002 6.79002C4.38389 6.69742 4.49637 6.62583 4.62002 6.58002C4.86348 6.48 5.13656 6.48 5.38002 6.58002C5.50277 6.62761 5.61491 6.69898 5.71002 6.79002C5.89275 6.98165 5.99633 7.23525 6.00002 7.50002C6.00078 7.63163 5.97555 7.76209 5.92579 7.88392C5.87602 8.00576 5.8027 8.11658 5.71002 8.21002C5.61054 8.29802 5.49951 8.37204 5.38002 8.43002C5.25911 8.47783 5.13003 8.50161 5.00002 8.50002Z" />
                    <path d="M5.00002 13C4.86934 12.9984 4.74024 12.9712 4.62002 12.92C4.49883 12.8693 4.38722 12.7983 4.29002 12.71C4.19734 12.6165 4.12401 12.5057 4.07425 12.3839C4.02448 12.262 3.99926 12.1316 4.00002 12C4.0037 11.7352 4.10728 11.4816 4.29002 11.29C4.38722 11.2016 4.49883 11.1306 4.62002 11.08C4.80104 10.996 5.00303 10.9682 5.20002 11L5.38002 11.06L5.56002 11.15C5.6124 11.1869 5.6625 11.227 5.71002 11.27C5.89749 11.4666 6.00144 11.7283 6.00002 12C6.00002 12.2652 5.89466 12.5195 5.70712 12.7071C5.51959 12.8946 5.26523 13 5.00002 13Z" />
                    <path d="M4.99999 17.5C4.86998 17.5016 4.7409 17.4778 4.61999 17.43C4.50049 17.372 4.38947 17.298 4.28999 17.21C4.20166 17.1128 4.13063 17.0012 4.07999 16.88C4.02708 16.7603 3.99976 16.6309 3.99976 16.5C3.99976 16.3691 4.02708 16.2397 4.07999 16.12C4.13063 15.9988 4.20166 15.8872 4.28999 15.79C4.43061 15.6513 4.60919 15.5573 4.80317 15.5199C4.99716 15.4825 5.19788 15.5034 5.37999 15.58C5.50274 15.6276 5.61488 15.699 5.70999 15.79C5.79832 15.8872 5.86935 15.9988 5.91999 16.12C5.97289 16.2397 6.00022 16.3691 6.00022 16.5C6.00022 16.6309 5.97289 16.7603 5.91999 16.88C5.86935 17.0012 5.79832 17.1128 5.70999 17.21C5.61655 17.3027 5.50573 17.376 5.38389 17.4258C5.26206 17.4756 5.1316 17.5008 4.99999 17.5Z" />
                </svg>
                <div class="project-information project-name">
                    <h2><?= $project['project_name'] ?></h2>
                    <p>by <b><?= $project['owner'] ?></b></p>
                </div>
            </div>

            <div class="widget-table">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 4.25H15.75V3C15.75 2.80109 15.671 2.61032 15.5303 2.46967C15.3897 2.32902 15.1989 2.25 15 2.25C14.8011 2.25 14.6103 2.32902 14.4697 2.46967C14.329 2.61032 14.25 2.80109 14.25 3V4.25H9.75V3C9.75 2.80109 9.67098 2.61032 9.53033 2.46967C9.38968 2.32902 9.19891 2.25 9 2.25C8.80109 2.25 8.61032 2.32902 8.46967 2.46967C8.32902 2.61032 8.25 2.80109 8.25 3V4.25H7C6.27065 4.25 5.57118 4.53973 5.05546 5.05546C4.53973 5.57118 4.25 6.27065 4.25 7V18C4.25 18.7293 4.53973 19.4288 5.05546 19.9445C5.57118 20.4603 6.27065 20.75 7 20.75H17C17.7293 20.75 18.4288 20.4603 18.9445 19.9445C19.4603 19.4288 19.75 18.7293 19.75 18V7C19.75 6.27065 19.4603 5.57118 18.9445 5.05546C18.4288 4.53973 17.7293 4.25 17 4.25ZM7 5.75H8.25V7C8.25 7.19891 8.32902 7.38968 8.46967 7.53033C8.61032 7.67098 8.80109 7.75 9 7.75C9.19891 7.75 9.38968 7.67098 9.53033 7.53033C9.67098 7.38968 9.75 7.19891 9.75 7V5.75H14.25V7C14.25 7.19891 14.329 7.38968 14.4697 7.53033C14.6103 7.67098 14.8011 7.75 15 7.75C15.1989 7.75 15.3897 7.67098 15.5303 7.53033C15.671 7.38968 15.75 7.19891 15.75 7V5.75H17C17.3315 5.75 17.6495 5.8817 17.8839 6.11612C18.1183 6.35054 18.25 6.66848 18.25 7V9.75H5.75V7C5.75 6.66848 5.8817 6.35054 6.11612 6.11612C6.35054 5.8817 6.66848 5.75 7 5.75ZM17 19.25H7C6.66848 19.25 6.35054 19.1183 6.11612 18.8839C5.8817 18.6495 5.75 18.3315 5.75 18V11.25H18.25V18C18.25 18.3315 18.1183 18.6495 17.8839 18.8839C17.6495 19.1183 17.3315 19.25 17 19.25Z" />
                </svg>
                <div class="project-information">
                    <p>Due date</p>
                    <h2><?= $project['due_date']->format('Y-m-d') ?></h2>
                </div>
            </div>

            <div class="widget-table">
                <div class="project-information">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 20.75C11.8019 20.7474 11.6126 20.6676 11.4725 20.5275C11.3324 20.3874 11.2526 20.1981 11.25 20V4C11.25 3.80109 11.329 3.61032 11.4697 3.46967C11.6103 3.32902 11.8011 3.25 12 3.25C12.1989 3.25 12.3897 3.32902 12.5303 3.46967C12.671 3.61032 12.75 3.80109 12.75 4V20C12.7474 20.1981 12.6676 20.3874 12.5275 20.5275C12.3874 20.6676 12.1981 20.7474 12 20.75Z" />
                        <path d="M13.5 18.75H7C6.80109 18.75 6.61032 18.671 6.46967 18.5303C6.32902 18.3897 6.25 18.1989 6.25 18C6.25 17.8011 6.32902 17.6103 6.46967 17.4697C6.61032 17.329 6.80109 17.25 7 17.25H13.5C14.1615 17.3089 14.8199 17.1064 15.3339 16.6859C15.8479 16.2653 16.1768 15.6601 16.25 15C16.1768 14.3399 15.8479 13.7347 15.3339 13.3141C14.8199 12.8935 14.1615 12.691 13.5 12.75H10.5C9.97449 12.7839 9.44746 12.7136 8.94915 12.5433C8.45085 12.373 7.99107 12.106 7.5962 11.7576C7.20134 11.4092 6.87915 10.9863 6.64814 10.513C6.41712 10.0398 6.28182 9.52562 6.25 8.99998C6.28182 8.47434 6.41712 7.96016 6.64814 7.48694C6.87915 7.01371 7.20134 6.59076 7.5962 6.24235C7.99107 5.89394 8.45085 5.62692 8.94915 5.45663C9.44746 5.28633 9.97449 5.21611 10.5 5.24998H16C16.1989 5.24998 16.3897 5.329 16.5303 5.46965C16.671 5.61031 16.75 5.80107 16.75 5.99998C16.75 6.1989 16.671 6.38966 16.5303 6.53031C16.3897 6.67097 16.1989 6.74998 16 6.74998H10.5C9.83846 6.69103 9.18013 6.89353 8.6661 7.3141C8.15206 7.73468 7.82321 8.33987 7.75 8.99998C7.82321 9.6601 8.15206 10.2653 8.6661 10.6859C9.18013 11.1064 9.83846 11.3089 10.5 11.25H13.5C14.0255 11.2161 14.5525 11.2863 15.0508 11.4566C15.5492 11.6269 16.0089 11.8939 16.4038 12.2423C16.7987 12.5908 17.1208 13.0137 17.3519 13.4869C17.5829 13.9602 17.7182 14.4743 17.75 15C17.7182 15.5256 17.5829 16.0398 17.3519 16.513C17.1208 16.9863 16.7987 17.4092 16.4038 17.7576C16.0089 18.106 15.5492 18.373 15.0508 18.5433C14.5525 18.7136 14.0255 18.7839 13.5 18.75Z" />
                    </svg>
                    <p>Project status</p>
                    <h2>
                        <?php if ($project['status'] != 13) {
                            echo $project['status_name'];
                        } else {
                            echo 'Closed';
                        } ?>
                    </h2>
                </div>
            </div>
        </div>

        <!-- Form -->
        <section aria-labelledby="project-information" id="section1" data-nav="Project information" class="active">
            <form method="post" class="form" id='project_content'>
                <input type="hidden" id='project_id' value='<?= $project['project_id'] ?>'>
                <div class="widget-table">
                    <h2>Project information</h2>
                    <div class="formRow">
                        <div class="oneTwo">
                            <label for="project_name">Project Name</label>
                            <input id="project_name" type="text" placeholder="Project Name" name='project_name' value="<?= $project['project_name'] ?>" />
                        </div>
                        <div class="oneTwo">
                            <label for="location">Centura Location</label>
                            <select name="location" id="location" disabled>
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['location_id'] ?>" <?php if ($l['location_id'] == $project['centura_location_id']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for="owner">Worksheet Owner</label>
                            <input id="owner" type="text" value='<?= $project['owner_name'] ?>' readonly />
                            <input type="hidden" name='owner' value='<?= $project['owner'] ?>'>
                        </div>
                        <div class="oneTwo">
                            <label for="quote_no">Quote ID</label>
                            <input id="quote_no" type="text" placeholder="123456" name='quote_no' value="<?= $project['quote_no'] ?>" readonly />
                            <input name='create_date' type="hidden" value='<?= $project['create_date']->format('Y-m-d') ?>' />
                        </div>
                        <div class="oneTwo">
                            <label for="project_location_address">Project Location</label>
                            <input type="text" name='project_location_address' id="project_location_address" value='<?= $project['project_location_address'] ?>' />
                        </div>
                        <div class="oneTwo">
                            <label for="status">Status</label>
                            <select id="status" name="status" disabled>
                                <option>-- Select status --</option>
                                <?php foreach ($this->status as $s) { ?>
                                    <option value="<?= $s['uid'] ?>" <?php if ($s['uid'] == $project['status']) echo 'selected' ?>><?= $s['Status'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for="reed">REED ID</label>
                            <input id="reed" type="text" name='reed' placeholder="REED Format" value="<?= $project['reed'] ?>" />
                        </div>
                        <div class="oneTwo">
                            <label for="market_segment">Market Segment</label>
                            <select id="market_segment" name="market_segment" disabled>
                                <option>-- Choose segment --</option>
                                <?php foreach ($this->seg as $s) { ?>
                                    <option value="<?= $s['uid'] ?>" <?php if ($s['uid'] == $project['market_segment']) echo 'selected' ?>><?= $s['Market_Segment'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo required-field">
                            <label for='architect_name'>Project Architect/Owner</label>
                            <input type='text' name="architect_name" id='architect_name' class="validate[required] tipN" original-title="Type 2 letter to start or add your own" value='<?= $this->arch_name ?>' />
                            <input type="hidden" name='architect' id='architect' value="<?= $project['architect'] ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="architect_loc">Architect Location</label>
                            <select id="architect_loc" name="architect_loc">
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['company_id'] ?>" <?php if ($l['company_id'] == $this->architect['Company_ID']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for='specifiler_name'>Specifier</label>
                            <input type='text' id='specifiler_name' name="specifiler_name" value='<?= $this->spec_name ?>' class="validate[required] tipN" original-title="Type 2 letter to start or add your own">
                            <input type="hidden" id='specifiler' name="specifiler" value="<?= $project['specifiler'] ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="specifiler_loc">Specifier Location</label>
                            <select id="specifiler_loc" name="specifiler_loc">
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['company_id'] ?>" <?php if ($l['company_id'] == $this->sepcloc['Company_ID']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for="due_date">Tender Due Date</label>
                            <input id="due_date" type="text" name='due_date' class="datepicker" value='<?= $project['due_date']->format('Y-m-d') ?>' disabled />
                        </div>
                        <div class="oneTwo">
                            <label for="required_date">Material Required Date</label>
                            <input id="required_date" type="text" name='required_date' class="datepicker" value='<?= $project['required_date']->format('Y-m-d') ?>' disabled />
                        </div>
                        <div class="oneTwo">
                            <label for="gerneral_contractor">General Contractor</label>
                            <input type="text" placeholder="Type Name" name="gerneral_contractor" id="gerneral_contractor" value='<?= ($this->gerneral_contractor['name'] ?? '') . ' - ' . ($this->gerneral_contractor['company_id'] ?? '') ?>' />
                            <input type="hidden" id="gerneral_contractor_id" name='gerneral_contractor_id' value="<?= $project['general_contractor_id'] ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="gerneral_contractor_loc">General Contractor Location</label>
                            <input type="text" id="gerneral_contractor_loc" name='gerneral_contractor_loc' value="<?= $this->gerneral_contractor['company_id'] ?? '-' ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="awarded_contractor">Awarded Sub Contractor</label>
                            <input type="text" id="awarded_contractor" name='awarded_contractor' placeholder="Type Name" value='<?= ($this->awarded_sub_contracotr['name'] ?? '') . ' - ' . ($this->awarded_sub_contracotr['company_id'] ?? '') ?>' />
                            <input type="hidden" id="awarded_contractor_id" name='awarded_contractor_id' value="<?= $project['awarded_sub_contracotr_id'] ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="awarded_contractor_loc">Awarded Contractor Location</label>
                            <input type="text" id="gerneral_contractor_loc" name='gerneral_contractor_loc' value="<?= $this->awarded_sub_contracotr['company_id'] ?? '-' ?>">
                        </div>
                    </div>
                </div>
            </form>
        </section>

        <section aria-labelledby="quoted-items" id="section2" data-nav="Quoted items">
            <form method="post" class="form" id='project_log'>
                <div class="widget-table">
                    <h2>Quoted items</h2>
                    <div class="title">
                        <?php if ($this->owner == 1) { ?><a href="#" title="" class="button greenB" style="margin: 5px;" id="add_item"><span>Add New</span></a><a href="#" title="" class="button redB" style="margin: 5px;display:none" id="save_item"><span>Save</span></a><?php } ?>
                    </div>
                    <table width="100%" class="sTable display nowrap" id="items">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Quality Quoted</th>
                                <th>Unit Price</th>
                                <th>Unit Of Measure</th>
                                <th>Price Quoted</th>
                                <th>Note</th>
                            </tr>
                        </thead>
                        <tbody id="item_body">
                            <?php foreach ($this->items as $i) { ?>
                                <tr name="item[<?= $i['product_id'] ?>]">
                                    <td><input type="checkbox" name="item[<?= $i['product_id'] ?>]"></td>
                                    <td><b><?= $i['product_id'] ?> - <?= $i['item_desc'] ?></b>
                                        <?php if ($i['note'] != null) { ?>
                                            <textarea rows="1" cols="" name="item[<?= $i['product_id'] ?>][note]"><?= $i['note'] ?></textarea>
                                        <?php } ?>
                                    </td>
                                    <td><?= $i['qty'] ?></td>
                                    <td><?= $i['unit_price'] ?></td>
                                    <td><?= $i['uom'] ?></td>
                                    <td><?= $i['subtotal'] ?></td>
                                    <input type="hidden" name="item[<?= $i['product_id'] ?>][qty]" value="<?= $i['qty'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][unit_price]" value="<?= $i['unit_price'] ?>">
                                    <input type="hidden" name="item[<?= $i['product_id'] ?>][uom]" value="<?= $i['uom'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][total_price]" value="<?= $i['subtotal'] ?>">
                                </tr>
                            <?php } ?>
                        </tbody>
                    </table>
                </div>
            </form>
        </section>

        <section aria-labelledby="project-log" id="section3" data-nav="Project log">
            <div class="widget-table">
                <h2>Project log</h2>
                <table cellpadding="0" cellspacing="0" width="100%" class="display" id='project_memo'>
                    <thead>
                        <tr>
                            <th data-priority="1">Log Date</th>
                            <th>Action Items Completed</th>
                            <th data-priority="2">Follow Up Date</th>
                            <th data-priority="3">Next Action Required</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </section>
    </div>
</main>

<!-- Right panel -->
<div class="sidebar-container">
    <aside id="sidebar-quicklinks" class="sidebar">
        <nav aria-label="Actions" class="sidebar-inner">
            <div class="sidebar-inner-nav">
                <div class="quick-links">
                    <ol>
                        <?php if ($project['status'] != 13) { ?>
                            <li><a class='quick-link add_pro' href="/quote/index/project/<?= $project['project_id'] ?>" title="add">
                                    <span class='icon icon-dollar'></span>
                                    Make Quote</a></li>
                        <?php } ?>
                        <li><a class='quick-link' href="<?= 'http://' . SITEURL . "/dompdf/print.php?url=" . 'http://' . SITEURL . "/project/print/id/" . $project['project_id'] . "?company=" . substr($project['quote_no'], 0, 3) . "&name=Centura_Project_" . preg_replace("![^a-z0-9]+!i", "_", $project['project_name']) . '.pdf' ?>" title="print">
                                <span class='icon icon-pdf'></span>
                                Print Project</a></li>
                    </ol>
                </div>
            </div>
        </nav>
    </aside>
</div>

<script type="text/javascript">
    $("textarea").each(function() {
        this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
    }).on("input", function() {
        this.style.height = 0;
        this.style.height = (this.scrollHeight) + "px";
    });

    $('input').attr('readonly', 'readonly');
    $('.selector').attr('diabled', 'diabled');

    let itemTable = $("#items").DataTable({
        ajax: {
            url: "/project/item/id/" + $('#project_id').val(),
            dataSrc: ''
        },
        processing: true,
        columns: [{
                data: "product_id",
                render: function(data, type, row, meta) {
                    return '<b class="item-name">' + data + '</b>' + '<br>' + row.item_desc;
                }
            },
            {
                data: "qty"
            },
            {
                data: "unit_price"
            },
            {
                data: "uom"
            },
            {
                data: "subtotal"
            },
            {
                data: "note"
            }
        ],
        columnDefs: [{
                targets: [0, 1, 2, 3, 4],
                className: 'dt-body-center'
            },
            {
                targets: [0, 1, 2, 3, 4, 5],
                className: 'dt-head-center'
            },
        ],
        layout: {
            topStart: null,
            topEnd: null
        },
        order: {
            data: "added.date"
        },
        paging: false,
        scrollX: true,
        fixedColumns: {
            start: 1
        }
    });

    $('#project_memo').DataTable({
        ajax: {
            url: "/project/memo/id/" + $('#project_id').val(),
            dataSrc: ''
        },
        processing: true,
        columns: [{
                data: "added.date",
                render: function(data) {
                    let date = new Date(data);
                    return date.toLocaleString();
                }
            },
            {
                data: "title",
                render: function(data, type, row, meta) {
					if (row.content == null) {
						return '<p><b>' + data + '</b></p>';
					} else {
						return '<p><b>' + data + '</b></br>' + row.content + '</p>';
					}
				}
            },
            {
                data: "follow_up_date.date",
                render: function(data) {
                    let date = new Date(data);
                    return date.toLocaleDateString();
                }
            },
            {
                data: "type"
            }
        ],
        columnDefs: [{
            targets: [0, 2],
            className: 'dt-body-center'
        }],
        order: [
            [0, "desc"]
        ]
    });
</script>