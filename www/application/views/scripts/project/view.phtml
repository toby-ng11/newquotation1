<?php
$session =  Zend_Registry::get('session');
$project = $this->project;
?>

<!-- Left panel -->
<div class="sidebar-container">
    <div class="toc-container">
        <aside class="toc">
            <nav>
                <div class="document-toc-container">
                    <section class="document-toc">
                        <header>
                            <h2 class="document-toc-heading">On this page</h2>
                        </header>
                        <ul id="document-toc-list" class="document-toc-list"></ul>
                    </section>
                </div>
            </nav>
        </aside>
        <section class="place side"></section>
    </div>
</div>

<!-- Title area -->
<main id="content" class="main-content">
    <div class="middleNav">
        <ul>
            <li class="mUser"><a href="#" title="Share"><span class="users"></span></a>
                <ul class="mSub1">
                    <li><a href="#" title="">Share user</a></li>
                    <li><a href="#" title="">Show Teamworks</a></li>
                </ul>
            </li>

            <li class="mOrders"><a href="#" title="Change Status"><span class="files"></span></a>
                <ul class="mSub4">
                    <li><a href="#" title="">Add</a></li>
                    <li><a href="#" title="">Save</a></li>
                    <li><a href="#" title="">Edit</a></li>
                    <li><a href="#" title="">Delete</a></li>
                </ul>
            </li>
        </ul>
        <div class="clear"></div>
    </div>

    <div class="main-page-content">
        <div class="main-page-content-header">
            <h1>View project</h1>
        </div>
        <?php if ($project['status'] != 13) { ?>
            <p>Track project data and events critical to close of sales.</p>
        <?php } ?>

        <?php if ($project['status'] == 13) { ?>
            <div class="nNote nInformation hideit">
                <p><strong>INFORMATION: </strong>This Project has been Closed!</p>
            </div>
        <?php } ?>

        <!-- Main content wrapper -->
        <!-- Note -->
        <!-- <div class="nNote nInformation hideit">
            <p><strong>INFORMATION: </strong>Quote Has been saved.</p>
        </div>-->

        <!-- Form -->
        <section aria-labelledby="project-information" id="section1" data-nav="Project information" class="active">
            <h2>Project information</h2>
            <h3><?= $project['project_name'] ?></h3>
            <form method="post" class="form" id='project_content'>
                <input type="hidden" id='project_id' value='<?= $project['project_id'] ?>'>
                <div class="widget-table">
                    <div class="formRow">
                        <div class="oneTwo">
                            <label for="project-name">Project Name</label>
                            <input id="project-name" type="text" placeholder="Project Name" name='project_name' value="<?= $project['project_name'] ?>" />
                        </div>
                        <div class="oneTwo">
                            <label for="location">Centura Location</label>
                            <select name="location" id="location" disabled>
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['location_id'] ?>" <?php if ($l['location_id'] == $project['centura_location_id']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for="owner">Worksheet Owner</label>
                            <input id="owner" type="text" value='<?= $project['owner_name'] ?>' readonly />
                            <input type="hidden" name='owner' value='<?= $project['owner'] ?>'>
                        </div>
                        <div class="oneTwo">
                            <label for="quote-id">Quote ID</label>
                            <input id="quote-id" type="text" placeholder="123456" name='quote_no' value="<?= $project['quote_no'] ?>" readonly />
                            <input name='create_date' type="hidden" value='<?= $project['create_date']->format('Y-m-d') ?>' />
                        </div>
                        <div class="oneTwo">
                            <label for="project_location_address">Project Location</label>
                            <input type="text" name='project_location_address' id="project_location_address" value='<?= $project['project_location_address'] ?>' />
                        </div>
                        <div class="oneTwo">
                            <label for="status">Status</label>
                            <select id="status" name="status" disabled>
                                <option>-- Select status --</option>
                                <?php foreach ($this->status as $s) { ?>
                                    <option value="<?= $s['uid'] ?>" <?php if ($s['uid'] == $project['status']) echo 'selected' ?>><?= $s['Status'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for="reed">REED ID</label>
                            <input id="reed" type="text" name='reed' placeholder="REED Format" value="<?= $project['reed'] ?>" />
                        </div>
                        <div class="oneTwo">
                            <label for="market-segment">Market Segment</label>
                            <select id="market-segment" name="market_segment" disabled>
                                <option>-- Choose segment --</option>
                                <?php foreach ($this->seg as $s) { ?>
                                    <option value="<?= $s['uid'] ?>" <?php if ($s['uid'] == $project['market_segment']) echo 'selected' ?>><?= $s['Market_Segment'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo required-field">
                            <label for='architect_name'>Project Architect/Owner</label>
                            <input type='text' name="architect_name" id='architect_name' class="validate[required] tipN" original-title="Type 2 letter to start or add your own" value='<?= $this->arch_name ?>' />
                            <input type="hidden" name='architect' id='architect' value="<?= $project['architect'] ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="architect_loc">Architect Location</label>
                            <select id="architect_loc">
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['company_id'] ?>" <?php if ($l['company_id'] == $this->architect['Company_ID']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for='specifiler_name'>Specifier</label>
                            <input type='text' id='specifiler_name' name="specifiler_name" value='<?= $this->spec_name ?>' class="validate[required] tipN" original-title="Type 2 letter to start or add your own">
                            <input type="hidden" id='specifiler' name="specifiler" value="<?= $project['specifiler'] ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="specifiler_loc">Specifier Location</label>
                            <select id="specifiler_loc">
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['company_id'] ?>" <?php if ($l['company_id'] == $this->sepcloc['Company_ID']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                        </div>
                        <div class="oneTwo">
                            <label for="due-date">Tender Due Date</label>
                            <input id="due-date" type="text" name='due_date' class="datepicker" value='<?= $project['due_date']->format('Y-m-d') ?>' disabled />
                        </div>
                        <div class="oneTwo">
                            <label for="required-date">Material Required Date</label>
                            <input id="required-date" type="text" name='required_date' class="datepicker" value='<?= $project['required_date']->format('Y-m-d') ?>' disabled />
                        </div>
                        <div class="oneTwo">
                            <label for="gerneral_contractor">General Contractor</label>
                            <input type="text" placeholder="Type Name" id="gerneral_contractor" value='<?= $this->gerneral_contractor['name'] . ' - ' . $this->gerneral_contractor['company_id'] ?>' />
                        </div>
                        <div class="oneTwo">
                            <label for="gerneral_contractor_loc">General Contractor Location</label>
                            <select id="gerneral_contractor_loc" disabled>
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['company_id'] ?>" <?php if ($l['company_id'] == $this->gerneral_contractor['company_id']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                            <input type="hidden" name='gerneral_contractor' value="<?= $project['general_contractor_id'] ?>">
                        </div>
                        <div class="oneTwo">
                            <label for="awarded_contractor">Awarded Sub Contractor</label>
                            <input type="text" placeholder="Type Name" id="awarded_contractor" value='<?= $this->awarded_sub_contracotr['name'] . ' - ' . $this->awarded_sub_contracotr['company_id'] ?>' />
                        </div>
                        <div class="oneTwo">
                            <label for="awarded_contractor_loc">Awarded Contractor Location</label>
                            <select id="awarded_contractor_loc" disabled>
                                <?php foreach ($this->locations as $l) { ?>
                                    <option value="<?= $l['company_id'] ?>" <?php if ($l['company_id'] == $this->awarded_sub_contracotr['company_id']) echo 'selected' ?>><?= $l['name'] ?></option>
                                <?php } ?>
                            </select>
                            <input type="hidden" name='awarded_contractor' value="<?= $project['awarded_sub_contracotr_id'] ?>">
                        </div>
                    </div>
                </div>
            </form>
        </section>

        <section aria-labelledby="quoted-items" id="section2" data-nav="Quoted items">
            <h2>Quoted items</h2>
            <form method="post" class="form" id='project_log'>
                <div class="widget-table">
                    <div class="title"><span class="titleIcon"><input type="checkbox" id="titleCheck" name="titleCheck" /></span>
                        <?php if ($this->owner == 1) { ?><a href="#" title="" class="button greenB" style="margin: 5px;" id="add_item"><span>Add New</span></a><a href="#" title="" class="button redB" style="margin: 5px;display:none" id="save_item"><span>Save</span></a><?php } ?>
                    </div>
                    <div class="clear"></div>
                    <table width="100%" class="sTable" id="items" style="text-align:center;">
                        <thead>
                            <tr>
                                <th></th>
                                <th width="50%">Item ID - Description</th>
                                <th>Quality Quoted</th>
                                <th>Unit Price</th>
                                <th>Unit Of Measure</th>
                                <th>Price Quoted</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="item_body">
                            <?php foreach ($this->items as $i) { ?>
                                <tr name="item[<?= $i['product_id'] ?>]">
                                    <td><input type="checkbox" name="item[<?= $i['product_id'] ?>]"></td>
                                    <td><?= $i['product_id'] ?> - <?= $i['item_desc'] ?>
                                        <textarea name="item[<?= $i['product_id'] ?>][note]"><?= $i['note'] ?></textarea>
                                    </td>
                                    <td><?= $i['qty'] ?></td>
                                    <td><?= $i['unit_price'] ?></td>
                                    <td><?= $i['uom'] ?></td>
                                    <td><?= $i['subtotal'] ?></td>
                                    <input type="hidden" name="item[<?= $i['product_id'] ?>][qty]" value="<?= $i['qty'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][unit_price]" value="<?= $i['unit_price'] ?>">
                                    <input type="hidden" name="item[<?= $i['product_id'] ?>][uom]" value="<?= $i['uom'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][total_price]" value="<?= $i['subtotal'] ?>">
                                    <td></a></td>

                                </tr>
                            <?php } ?>
                        </tbody>
                    </table>
                </div>
            </form>
        </section>

        <section aria-labelledby="project-log" id="section3" data-nav="Project log">
            <h2>Project log</h2>
            <div class="widget-table">
                <table cellpadding="0" cellspacing="0" width="100%" class="display no-wrap" id='project_memo'>
                    <thead>
                        <tr>
                            <th>Log Date</th>
                            <th>Action Items Completed</th>
                            <th>Follow Up Date</th>
                            <th>Next Action Required</th>
                            <th class="action">Delete</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </section>
    </div>
</main>

<!-- Right panel -->
<div class="sidebar-container">
    <aside id="sidebar-quicklinks" class="sidebar">
        <nav aria-label="Actions" class="sidebar-inner">
            <div class="sidebar-inner-nav">
                <div class="quick-links">
                    <ol>
                        <?php if ($project['status'] != 13) { ?>
                            <li><a class='quick-link add_pro' href="/quote/index/project/<?= $project['project_id'] ?>" title="add">
                            <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.25 15.75C14.84 15.75 14.5 16.09 14.5 16.5V18C14.5 18.69 13.94 19.25 13.25 19.25H5.75C5.06 19.25 4.5 18.69 4.5 18V6C4.5 5.31 5.06 4.75 5.75 4.75H9V9.5C9 9.91 9.34 10.25 9.75 10.25H14.5V11.5C14.5 11.91 14.84 12.25 15.25 12.25C15.66 12.25 16 11.91 16 11.5V9.5C16 9.3 15.92 9.11 15.78 8.97L10.28 3.47C10.14 3.33 9.95 3.25 9.75 3.25H5.75C4.23 3.25 3 4.48 3 6V18C3 19.52 4.23 20.75 5.75 20.75H13.25C14.77 20.75 16 19.52 16 18V16.5C16 16.09 15.66 15.75 15.25 15.75ZM10.5 5.81L13.44 8.75H10.5V5.81ZM20.94 14.29C20.9 14.38 20.85 14.46 20.78 14.53L17.78 17.53C17.63 17.68 17.44 17.75 17.25 17.75C17.06 17.75 16.87 17.68 16.72 17.53C16.43 17.24 16.43 16.76 16.72 16.47L18.44 14.75H9.75C9.34 14.75 9 14.41 9 14C9 13.59 9.34 13.25 9.75 13.25H18.44L16.72 11.53C16.43 11.24 16.43 10.76 16.72 10.47C17.01 10.18 17.49 10.18 17.78 10.47L20.78 13.47C20.85 13.54 20.9 13.62 20.94 13.71C21.02 13.89 21.02 14.1 20.94 14.28V14.29Z"/>
                            </svg>
                            Make Quote</a></li>
                        <?php } ?>
                        <li><a class='quick-link' href="<?= 'http://' . SITEURL . "/dompdf/print.php?url=" . 'http://' . SITEURL . "/project/print/id/" . $project['project_id'] . "?company=" . substr($project['quote_no'], 0, 3) . "&name=Centura_Project_" . preg_replace("![^a-z0-9]+!i", "_", $project['project_name']) . '.pdf' ?>" title="print">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
								<path d="M18.53 9L13 3.47C12.8595 3.32931 12.6688 3.25018 12.47 3.25H8C7.27065 3.25 6.57118 3.53973 6.05546 4.05546C5.53973 4.57118 5.25 5.27065 5.25 6V18C5.25 18.7293 5.53973 19.4288 6.05546 19.9445C6.57118 20.4603 7.27065 20.75 8 20.75H16C16.7293 20.75 17.4288 20.4603 17.9445 19.9445C18.4603 19.4288 18.75 18.7293 18.75 18V9.5C18.7421 9.3116 18.6636 9.13309 18.53 9ZM13.25 5.81L16.19 8.75H13.25V5.81ZM16 19.25H8C7.66848 19.25 7.35054 19.1183 7.11612 18.8839C6.8817 18.6495 6.75 18.3315 6.75 18V6C6.75 5.66848 6.8817 5.35054 7.11612 5.11612C7.35054 4.8817 7.66848 4.75 8 4.75H11.75V9.5C11.7526 9.69811 11.8324 9.88737 11.9725 10.0275C12.1126 10.1676 12.3019 10.2474 12.5 10.25H17.25V18C17.25 18.3315 17.1183 18.6495 16.8839 18.8839C16.6495 19.1183 16.3315 19.25 16 19.25Z" />
								<path d="M13.49 14.85C12.8751 14.4642 12.4124 13.8778 12.18 13.19C12.3953 12.5467 12.4603 11.8625 12.37 11.19C12.3412 11.0206 12.2586 10.865 12.1344 10.7462C12.0102 10.6274 11.8511 10.5518 11.6806 10.5305C11.5101 10.5092 11.3372 10.5433 11.1876 10.6279C11.038 10.7125 10.9197 10.843 10.85 11C10.7362 11.8085 10.822 12.6325 11.1 13.4C10.7202 14.2873 10.2963 15.1551 9.83001 16C9.12001 16.4 8.15001 17 8.00001 17.69C7.88001 18.25 8.93001 19.69 10.72 16.57C11.5159 16.2746 12.3312 16.034 13.16 15.85C13.7727 16.2003 14.4561 16.4088 15.16 16.46C15.3216 16.4642 15.4809 16.4206 15.6178 16.3345C15.7546 16.2484 15.863 16.1238 15.9292 15.9764C15.9955 15.8289 16.0167 15.6651 15.9901 15.5056C15.9636 15.3462 15.8905 15.1981 15.78 15.08C15.36 14.65 14.11 14.77 13.49 14.85ZM8.71001 17.85C8.99025 17.3705 9.36034 16.9495 9.80001 16.61C9.12001 17.69 8.71001 17.88 8.71001 17.86V17.85ZM11.63 11.04C11.89 11.04 11.87 12.19 11.69 12.5C11.5544 12.0285 11.5338 11.5312 11.63 11.05V11.04ZM10.76 15.92C11.0988 15.3019 11.3929 14.6602 11.64 14C11.9049 14.493 12.2734 14.9229 12.72 15.26C12.0491 15.4281 11.3934 15.6522 10.76 15.93V15.92ZM15.46 15.74C15.46 15.74 15.28 15.96 14.13 15.46C15.38 15.38 15.59 15.67 15.46 15.75V15.74Z" />
							</svg>
                        Print Project</a></li>
                    </ol>
                </div>
            </div>
        </nav>
    </aside>
</div>

<style>
    div.selector {
        width: 290px;
    }

    div.selector select {
        width: 300px;
    }

    div.selector span {
        width: 290px;
    }
</style>

<script type="text/javascript">
    const items = ["Project information", "Quoted items", "Project log"];
    createTocList(items);

    $('input').attr('readonly', 'readonly');
    $('.selector').attr('diabled', 'diabled');

    $('#project_memo').DataTable({
		ajax: {
			url: "/project/memo/id/" + $('#project_id').val(),
			dataSrc: ''
		},
		processing: true,
		columns: [
            { data: "added.date"},
			{ data: "title"},
			{ data: "follow_up_date.date"},
			{ data: "type"},
			{ data: "memo_id", createdCell: function(cell, cellData, rowData, rowIndex, colIndex) {
				<?php if ($this->owner == 1) { ?>
					$(cell).html("<a target='_blank' href='/memo/delete/id/" + rowData.memo_id + "'><img src='/images/icons/dark/close.png' alt='delete'></a>");
					<?php } else { ?>
					$(cell).html("");
				<?php } ?>
			}},
		],
		columnDefs: [{
			targets: [0],
			render: function(data) {
				let DateTime = luxon.DateTime;
				let d = DateTime.fromSQL(data).setLocale('en').toFormat('f');
				return d;
			}
		}, {
			targets: [2],
			render: function(data) {
				let DateTime = luxon.DateTime;
				let d = DateTime.fromSQL(data).setLocale('en').toFormat('D');
				return d;
			}
		}],
		fixedColumns: {
			start: 1,
			end: 1
		},
		order: [[0, "desc"]]
	});
</script>

</div>