<?php $session = Zend_Registry::get('session'); ?>

<!-- Left panel -->
<div class="sidebar-container">
    <div class="toc-container">
        <aside class="toc">
            <nav>
                <div class="document-toc-container">
                    <section class="document-toc">
                        <header>
                            <h2 class="document-toc-heading">On this page</h2>
                        </header>
                        <ul id="document-toc-list" class="document-toc-list"></ul>
                    </section>
                </div>
            </nav>
        </aside>
        <section class="place side"></section>
    </div>
</div>

<!-- Main page -->
<main id="content" class="main-content">
    <div class="middleNav">
        <ul>
            <li class="mUser"><a href="#" title="Share"><span class="users"></span></a>
                <ul class="mSub1">
                    <li><a href="#" title="">Share user</a></li>
                    <li><a href="#" title="">Show Teamworks</a></li>
                </ul>
            </li>

            <li class="mOrders"><a href="#" title="Change Status"><span class="files"></span></a>
                <ul class="mSub4">
                    <li><a href="#" title="">Add</a></li>
                    <li><a href="#" title="">Save</a></li>
                    <li><a href="#" title="">Edit</a></li>
                    <li><a href="#" title="">Delete</a></li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="main-page-content">
        <header class="main-page-content-header">
            <h1>Quote Approval</h1>
        </header>

        <!-- Form -->
            <h2>Quotes Waiting for Approval: <?= count($this->waiting) ?></h2>
            <div class="widget-table">
                <table width="100%" class="display nowrap" id='waiting'>
                    <thead>
                        <tr>
                            <th>Quote ID</th>
                            <th>Project Name</th>
                            <th>Sales Rep.</th>
                            <th>Contractor</th>
                            <th>Arch. Sales Rep.</th>
                            <th>Segment</th>
                            <th>Date</td>
                            <th>Ship Required Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                </table>
            </div>

            <h2>Approved Quotes: <?= count($this->approved) ?></h2>
            <div class="widget-table">
                <table width="100%" class="display nowrap" id='approved'>
                    <thead>
                        <tr>
                            <th>Quote ID</th>
                            <th>Project Name</th>
                            <th>Sales Rep.</th>
                            <th>Contractor/Company</th>
                            <th>Arch. Sale Rep.</th>
                            <th>Segment</th>
                            <th>Quote Date</th>
                            <th>Expire Date</th>
                            <th>Ship Required Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                </table>
            </div>

        <h2>Disapproved Quotes: <?= count($this->disapproved) ?></h2>
        <div class="widget-table">
            <table width="100%" class="display nowrap" id='disapproved'>
                <thead>
                    <tr>
                        <th>Action</th>
                        <th>Quote ID</th>
                        <th>Project Name</th>
                        <th>Sales Rep.</th>
                        <th>Contractor/Company</th>
                        <th>Arch. Sale Rep.</th>
                        <th>Segment</th>
                        <th>Quote Date</th>
                        <th>Expire Date</th>
                        <th>Ship Required Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</main>

<!-- Right panel -->
<div class="statsRow">
    <div class="wrapper">
        <div class="controlB">
            <ul>
                <!--<li><a href="/quote" title=""><img src="/images/icons/control/32/plus.png" alt="" /><span>Add Quote</span></a></li>-->
                <!-- <li><a href="#" title=""><img src="images/icons/control/32/doc_edit.png" alt="" /><span>Edit Project</span></a></li>
                    <li><a href="#" title=""><img src="images/icons/control/32/refresh.png" alt="" /><span>Update Project</span></a></li>
                    <li><a href="#" title=""><img src="images/icons/control/32/save.png" alt="" /><span>Save Project</span></a></li>
                    <li><a href="#" title=""><img src="images/icons/control/32/delete.png" alt="" /><span>Delete Project</span></a></li>-->
            </ul>
            <div class="clear"></div>
        </div>
    </div>
</div>

<script>
    $('#waiting').DataTable({
        ajax: {
            url: "/index/approvalwaiting",
            dataSrc: ''
        },
        columns: [
            { data: "quote_id", createdCell: function(cell, cellData, rowData, rowIndex, colIndex) {
                $(cell).html("<a target='_blank' href='/approve/index/id/"+rowData.quote_id+"'>"+rowData.quote_id+"</a>");
            }},
            { data: "project_name"},
            { data: "sale_name"},
            { data: "customer"},
            { data: "arch_name"},
            { data: "quote_segment"},
            { data: "quote_date.date"},
            { data: "ship_required_date.date"},
            { data: "status_name"}
        ],
        columnDefs: [{
            targets: [6, 7],
            render: function (data) {
                let DateTime = luxon.DateTime;
                let d = DateTime.fromSQL(data).setLocale('en').toFormat('D');
                return d;
            }}
        ],
        processing: true,
        //serverSide: true,
        order: [[0, "desc"]],
        fixedColumns: { start: 1, end: 1},
        scrollX: true
    });

    $('#approved').DataTable({
        ajax: {
            url: "/index/approvalapproved",
            dataSrc: ''
        },
        columns: [
            { data: "quote_id", createdCell: function(cell, cellData, rowData, rowIndex, colIndex) {
                $(cell).html("<a target='_blank' href='/approve/index/id/"+rowData.quote_id+"'>"+rowData.quote_id+"</a>");
            }},
            { data: "project_name"},
            { data: "sale_name"},
            { data: "customer"},
            { data: "arch_name"},
            { data: "quote_segment"},
            { data: "quote_date.date"},
            { data: "expire_date.date", "createdCell": function(cell, cellData, rowData, rowIndex, colIndex) {
                let d = new Date(cellData);
                let today = new Date(); 
                if (d <= today) {$(cell).addClass("red");}
            }},
            { data: "ship_required_date.date"},
            { data: "status_name"}
        ],
        columnDefs: [{
            targets: [6, 7, 8],
            render: function (data) {
                let DateTime = luxon.DateTime;
                let d = DateTime.fromSQL(data).setLocale('en').toFormat('D');
                return d;
            }}
        ],
        processing: true,
        order: [[0, "desc"]],
        fixedColumns: { start: 1, end: 1},
        scrollX: true
    });

    $('#disapproved').DataTable({
        ajax: {
            url: "/index/approvaldisapproved",
            dataSrc: ''
        },
        columns: [
            { data: "quote_id", createdCell: function(cell, cellData, rowData, rowIndex, colIndex) {
                $(cell).html("<a target='_blank' href='/approve/index/id/"+rowData.quote_id+"'>"+rowData.quote_id+"</a>");
            }},
            { data: "quote_id", createdCell: function(cell, cellData, rowData, rowIndex, colIndex) {
                $(cell).html("<a target='_blank' href='/quote/edit/id/"+rowData.quote_id+"'>"+rowData.quote_id+"</a>");
            }},
            { data: "project_name"},
            { data: "sale_name"},
            { data: "customer"},
            { data: "arch_name"},
            { data: "quote_segment"},
            { data: "quote_date.date"},
            { data: "expire_date.date", "createdCell": function(cell, cellData, rowData, rowIndex, colIndex) {
                let d = new Date(cellData);
                let today = new Date(); 
                if (d <= today) {$(cell).addClass("red");}
            }},
            { data: "ship_required_date.date"},
            { data: "status_name"}
        ],
        columnDefs: [{
            targets: [7, 8, 9],
            render: function (data) {
                let DateTime = luxon.DateTime;
                let d = DateTime.fromSQL(data).setLocale('en').toFormat('D');
                return d;
            }}
        ],
        processing: true,
        order: [[0, "desc"]],
        fixedColumns: { start: 1, end: 1},
        scrollX: true
    });

</script>