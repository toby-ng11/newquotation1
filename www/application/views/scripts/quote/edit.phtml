<?php $session =  Zend_Registry::get('session'); ?>

<!-- Title area -->
<?php $project = $this->project; ?>
<main id="content" class="main-content">
	<div class="middleNav">
		<ul>
			<li class="mUser"><a href="#" title="Share"><span class="users"></span></a>
				<ul class="mSub1">
					<li><a href="#" title="">Share user</a></li>
					<li><a href="#" title="">Show Teamworks</a></li>
				</ul>
			</li>

			<li class="mOrders"><a href="#" title="Change Status"><span class="files"></span></a>
				<ul class="mSub4">
					<li><a href="#" title="">Add</a></li>
					<li><a href="#" title="">Save</a></li>
					<li><a href="#" title="">Edit</a></li>
					<li><a href="#" title="">Delete</a></li>
				</ul>
			</li>
		</ul>
	</div>

	<div class="main-page-content">
		<header class="main-page-content-header">
			<h1>Price Quote</h1>
		</header>

		<!-- Main content wrapper -->
		<section aria-labelledby="project-information" id="section1" data-nav="Project information" class="active">
			<h2>Project information</h2>
			<div class="widget-information">
				<div class="widget-table">
					<div class="project-information">
						<p>Project Name: <b><?= $project['project_name'] ?></b><br>
							Project Quote No: <b><?= $project['quote_no'] ?></b><br>
							Worksheet Owner: <b><?= $project['owner'] ?></b><br>
							Status: <b><?= $project['status_name'] ?></b><br>
							Due Date: <b><?= $project['due_date']->format('Y-m-d') ?></b>
						</p>
					</div>
				</div>
				<div class="widget-table">
					<div id="status">
						<?php if ($this->quote['approve_status'] == 1) { ?>
							<div class="nNote nInformation hideit">
								<p><strong>INFORMATION: </strong>Your quote is waiting for approval.</p>
							</div>
						<?php } ?>
						<?php if ($this->quote['approve_status'] == 10) { ?>
							<div class="nNote nSuccess hideit">
								<p><strong>INFORMATION: </strong>Your quote has been approved.</p>
							</div>
						<?php } ?>
						<?php if ($this->quote['approve_status'] == -1) { ?>
							<div class="nNote nFailure hideit">
								<p><strong>INFORMATION: </strong>Your quote is disapproved.</p>
							</div>
						<?php } ?>
					</div>
				</div>
			</div>
		</section>

		<!-- Form -->
		<form method='post' class="form" id="quote_content">
			<section aria-labelledby="customer-information" id="section2" data-nav="Customer information">
				<h2>Customer infomation</h2>
				<div class="widget-table" id="customer_info">
					<div>
						<button type="button" class="button action has-icon new-customer small" id="add_new_mode">
							<span>New Customer</span>
						</button>
						<button type="button" class="button action has-icon discard-customer small basic" style='display:none;' id="discard_new_mode">
							<span>Discard Adding</span>
						</button>
					</div>
					<input type="hidden" name='project_id' value="<?= $project['project_id'] ?>" />
					<div class="formRow">
						<div class="oneTwo required-field">
							<label for="quote">Quote To</label>
							<input type="text" value="<?= $this->customer['name'] ?>" id='quote' name='name' />
						</div>

						<div class="oneTwo required-field">
							<label for="address">Address</label>
							<input type="text" value="<?= $this->customer['phys_address1'] ?>" id='address' name='phys_address1' readonly />
						</div>
						<div class="oneTwo required-field">
							<label for="tel">Phone Number</label>
							<input type="text" id='tel' name='phone' class="maskPhoneExt" value="<?= $this->customer['tel'] ?>" id='tel' name='tel' readonly />
						</div>
						<div class="oneTwo required-field">
							<label for="customer_id">Customer ID</label>
							<input name='customer_id' type="text" id='customer_id' class="validate[custom[integer]]" value="<?= $this->customer['customer_id'] ?>" placeholder="Leave blank for add new customer" readonly />
						</div>
						<div class="oneTwo required-field">
							<label for="contact">Contact</label>
							<input type="text" id='contact' name='fullname' value="<?= $this->customer['fullname'] ?>" class="validate[required]" placeholder="Enter Customer Name to fetch existing customer" />
						</div>
						<div class="oneTwo required-field">
							<label for="customer_email">Email</label>
							<input type="text" value="<?= $this->customer['email'] ?>" id='customer_email' name='Contacts_email' class="validate[custom[email]]" placeholder="Enter Customer Email to fetch existing customer">
						</div>
					</div>
				</div>
			</section>

			<section aria-labelledby="quote-information" id="section3" data-nav="Quote information">
				<h2>Quote infomation</h2>
				<div class="widget-table">
					<div class="formRow">
						<div class="oneTwo">
							<label for="quote-number">Quote number</label>
							<input id="quote-number" type="text" value='<?= $this->quote['quote_id'] ?>' readonly />
						</div>
						<div class="oneTwo">
							<label for="quote-date">Quote date</label>
							<input id="quote-date" type="text" class="datepicker" value="<?= $this->quote['quote_date']->format('Y-m-d') ?>" />
						</div>
						<div class="oneTwo">
							<label for='ship_required_date'>Ship required date</label>
							<input id='ship_required_date' type="text" class="datepicker" name='ship_required_date' value="<?php if ($this->quote['ship_required_date'] != null && $this->quote['ship_required_date']->format('Y-m-d') > '2000-01-01') {
																																echo $this->quote['ship_required_date']->format('Y-m-d');
																															} ?>" />
						</div>
						<div class="oneTwo">
							<label for='quote_type'>Quote type</label>
							<select name="quote_type_id" id='quote_type' class="validate[required]">
								<option value="">Select Quote type</option>
								<?php foreach ($this->type as $t) { ?>
									<option value="<?= $t['uid'] ?>" <?php if ($t['uid'] == $this->quote['quote_type_id']) echo 'selected'; ?>><?= $t['type'] ?></option>
								<?php } ?>
							</select>
						</div>

						<div class="oneTwo">
							<label for="project-name">Project name</label>
							<input id="project-name" type="text" value="<?= $project['project_name'] ?>" readonly />
						</div>

						<div class="oneTwo">
							<label for="project-location">Project location</label>
							<input id="project-location" type="text" value="<?= $project['project_location_address'] ?>" readonly />
						</div>

						<div class="oneTwo">
							<label for='sale_rep'>Sales Representative</label>
							<input id='sale_rep' name='sale_rep' type="text" value="<?= $this->quote['sales_id'] ?>" readonly />
						</div>

						<div class="oneTwo required-field">
							<label for='arch'>Architect's Representative</label>
							<select id='arch' name='arch' class="validate[required]">
								<?php if ($session->user['approve_id'] != null) { ?>
									<?php foreach ($this->arch as $a) { ?>
										<option value="<?= $a['id'] ?>" <?php if ($a['id'] == $this->quote['arch']) echo 'selected'; ?>><?= $a['name'] . ' - ' . $a['default_company'] ?></option>
									<?php } ?>
								<?php } else { ?>
									<?php foreach ($this->arch as $a) { ?>
										<?php if ($a['id'] == $this->quote['arch']) { ?><option value="<?= $a['id'] ?>" selected><?= $a['name'] . ' - ' . $a['default_company'] ?></option> <?php } ?>
									<?php } ?>
								<?php } ?>
							</select>
						</div>
						<input type="hidden" name="sales_id" value="<?= $session->user['id'] ?>" />

						<div class=" oneTwo required-field">
							<label for='Segment'>Segment</label>
							<input type="text" class="validate[required]" id='Segment' placeholder="123456-" name='quote_segment' value='<?= $this->quote['quote_segment'] ?>' />
						</div>

						<div class="oneTwo required-field">
							<label for="quote_approval">Quote approval</label>
							<select id="quote_approval">
								<?php foreach ($this->approval as $a) {
									if ($a['uid'] == $this->quote['quote_approval']) { ?>
										<option value="
												<?= $a['uid'] ?>" selected><?= $a['Name'] . ' - ' . $a['Company_ID'] ?>
										</option>
								<?php }
								} ?>
							</select>
						</div>
					</div>
				</div>
			</section>

			<section aria-labelledby="items" id="section4" data-nav="Items">
				<h2>Items</h2>
				<div class="widget-table">
					<a href="#" title="" class="button greenB" style="margin: 5px;" id="opener"><span>Add new Item</span></a>
					<table cellpadding="0" cellspacing="0" width="100%" class="sTable" id="items" style="text-align:center;">
						<thead>
							<tr>
								<th></th>
								<th width="50%">Item ID - Description</th>
								<th>Quality Quoted</th>
								<th>Unit Price</th>
								<th>Unit Of Measure</th>
								<th>Price Quoted</th>
								<th>Options</th>
							</tr>
						</thead>
						<tbody id="item_body">
							<?PHP foreach ($this->items as $i) { ?>
								<tr name="item[<?= $i['product_id'] ?>]">
									<td><input type="checkbox" name="item[<?= $i['product_id'] ?>]"></td>
									<td><b><?= $i['product_id'] ?> - <?= $i['item_desc'] ?></b>
										<textarea name="item[<?= $i['product_id'] ?>][note][]"><?= $i['note'] ?></textarea>
									</td>
									<td><?= $i['qty'] ?></td>
									<td><?= $i['unit_price'] ?></td>
									<td><?= $i['uom'] ?></td>
									<td><?= $i['subtotal'] ?></td>
									<input type="hidden" name="item[<?= $i['product_id'] ?>][qty][]" value="<?= $i['qty'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][unit_price][]" value="<?= $i['unit_price'] ?>">
									<input type="hidden" name="item[<?= $i['product_id'] ?>][uom][]" value="<?= $i['uom'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][total_price][]" value="<?= $i['subtotal'] ?>">
									<input type="hidden" class='sorts' name="item[<?= $i['product_id'] ?>][sort][]" value="<?= $i['sort_id'] ?>">
									<td>
										<div class="row-button">
											<a class="edit" href="#">
												<span class='button-wrap'>
													<span class='icon icon-edit'></span>
												</span>
											</a>
											<a class="delete" href="#">
												<span class='button-wrap'>
													<span class='icon icon-delete'></span>
												</span>
											</a>
										</div>
									</td>
								</tr>
							<?PHP } ?>
						</tbody>
					</table>
				</div>
			</section>

			<section aria-labelledby="comment" id="section5" data-nav="Comment">
				<h2>Comment</h2>
				<div class="widget-table">
					<div class="formRow">
						<div class="oneTwo">
							<label for="quote-note">Quote Note:</label>
							<textarea id="quote-note" rows="8" cols="" name="note" placeholder="Add quote note here..."><?= $this->quote['note'] ?></textarea>
						</div>
					</div>
				</div>
			</section>
		</form>

		<div id="dialog-message" title="Add Item">
			<form action="" class="dialog" id='item'>
				<div class="dialog-form">
					<div class="oneTwo required-field">
						<label for="item_input">Enter Item ID</label>
						<input type="text" name="item" id='item_input' class="validate[required]" />
						<input type="hidden" id="item_id" />
					</div>

					<div class="oneTwo required-field">
						<label for="uom">Unit of measure</label>
						<select name="uom" id='uom' class="validate[required]">
							<option value=''>Select UOM</option>
						</select>
					</div>

					<div class="oneTwo required-field">
						<label for='price'>Price</label>
						<input type="text" class="validate[required,custom[number]]" name="price" id='price' placeholder="You can override the price" />
					</div>

					<div class="oneTwo required-field">
						<label for='qty' class="formNote">Quantity</label>
						<input type="text" name="qty" id='qty' class="validate[required]" />
						<input type="hidden" id="is_edit" value='0' />
						<input type="hidden" id="note" value='' />
						<input type="hidden" id="sort" value='' />
					</div>
				</div>
			</form>
		</div>
	</div>
</main>

<!-- Right panel -->
<div class="sidebar-container">
	<aside id="sidebar-quicklinks" class="sidebar">
		<nav aria-label="Actions" class="sidebar-inner">
			<div class="sidebar-inner-nav">
				<div class="quick-links">
					<ol>
						<li><a href="/quote/index/project/<?= $project['project_id'] ?>" class="quick-link" title="">
								<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path d="M12.75 11.25V5C12.75 4.80109 12.671 4.61032 12.5303 4.46967C12.3897 4.32902 12.1989 4.25 12 4.25C11.8011 4.25 11.6103 4.32902 11.4697 4.46967C11.329 4.61032 11.25 4.80109 11.25 5V11.25H5C4.80109 11.25 4.61032 11.329 4.46967 11.4697C4.32902 11.6103 4.25 11.8011 4.25 12C4.25 12.1989 4.32902 12.3897 4.46967 12.5303C4.61032 12.671 4.80109 12.75 5 12.75H11.25V19C11.2526 19.1981 11.3324 19.3874 11.4725 19.5275C11.6126 19.6676 11.8019 19.7474 12 19.75C12.1989 19.75 12.3897 19.671 12.5303 19.5303C12.671 19.3897 12.75 19.1989 12.75 19V12.75H19C19.1989 12.75 19.3897 12.671 19.5303 12.5303C19.671 12.3897 19.75 12.1989 19.75 12C19.7474 11.8019 19.6676 11.6126 19.5275 11.4725C19.3874 11.3324 19.1981 11.2526 19 11.25H12.75Z" />
								</svg>
								Add New Quote</a></li>
						<!--<li><a href="#" title=""><img src="/images/icons/control/32/doc_edit.png" alt="" /><span>Edit Current</span></a></li>
                    <li><a href="#" title=""><img src="/images/icons/control/32/refresh.png" alt="" /><span>Update Quote</span></a></li>-->
						<?php if ($this->quote['approve_status'] != 10) { ?>
							<li><a href="#" title="save" class="quick-link save_quote">
									<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path d="M17 20.75H7C6.27065 20.75 5.57118 20.4603 5.05546 19.9445C4.53973 19.4288 4.25 18.7293 4.25 18V6C4.25 5.27065 4.53973 4.57118 5.05546 4.05546C5.57118 3.53973 6.27065 3.25 7 3.25H14.5C14.6988 3.25018 14.8895 3.32931 15.03 3.47L19.53 8C19.6707 8.14052 19.7498 8.33115 19.75 8.53V18C19.75 18.7293 19.4603 19.4288 18.9445 19.9445C18.4288 20.4603 17.7293 20.75 17 20.75ZM7 4.75C6.66848 4.75 6.35054 4.8817 6.11612 5.11612C5.8817 5.35054 5.75 5.66848 5.75 6V18C5.75 18.3315 5.8817 18.6495 6.11612 18.8839C6.35054 19.1183 6.66848 19.25 7 19.25H17C17.3315 19.25 17.6495 19.1183 17.8839 18.8839C18.1183 18.6495 18.25 18.3315 18.25 18V8.81L14.19 4.75H7Z" />
										<path d="M16.75 20H15.25V13.75H8.75V20H7.25V13.5C7.25 13.1685 7.3817 12.8505 7.61612 12.6161C7.85054 12.3817 8.16848 12.25 8.5 12.25H15.5C15.8315 12.25 16.1495 12.3817 16.3839 12.6161C16.6183 12.8505 16.75 13.1685 16.75 13.5V20Z" />
										<path d="M12.47 8.75H8.53001C8.3606 8.74869 8.19311 8.71403 8.0371 8.64799C7.88109 8.58195 7.73962 8.48582 7.62076 8.36511C7.5019 8.24439 7.40798 8.10144 7.34437 7.94443C7.28075 7.78741 7.24869 7.61941 7.25001 7.45V4H8.75001V7.25H12.25V4H13.75V7.45C13.7513 7.61941 13.7193 7.78741 13.6557 7.94443C13.592 8.10144 13.4981 8.24439 13.3793 8.36511C13.2604 8.48582 13.1189 8.58195 12.9629 8.64799C12.8069 8.71403 12.6394 8.74869 12.47 8.75Z" />
									</svg>
									Save Quote</a></li>
						<?php } ?>
						<li><a class="quick-link" href="<?= 'http://' . SITEURL . "/dompdf/print.php?url=" . 'http://' . SITEURL . "/quote/print/id/" . $this->quote['quote_id'] . "?company=" . substr($this->quote['quote_no'], 0, 3) . "&name=Centura_Quote_" . $this->quote['quote_id'] . '.pdf' ?>" title="print">
								<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path d="M18.53 9L13 3.47C12.8595 3.32931 12.6688 3.25018 12.47 3.25H8C7.27065 3.25 6.57118 3.53973 6.05546 4.05546C5.53973 4.57118 5.25 5.27065 5.25 6V18C5.25 18.7293 5.53973 19.4288 6.05546 19.9445C6.57118 20.4603 7.27065 20.75 8 20.75H16C16.7293 20.75 17.4288 20.4603 17.9445 19.9445C18.4603 19.4288 18.75 18.7293 18.75 18V9.5C18.7421 9.3116 18.6636 9.13309 18.53 9ZM13.25 5.81L16.19 8.75H13.25V5.81ZM16 19.25H8C7.66848 19.25 7.35054 19.1183 7.11612 18.8839C6.8817 18.6495 6.75 18.3315 6.75 18V6C6.75 5.66848 6.8817 5.35054 7.11612 5.11612C7.35054 4.8817 7.66848 4.75 8 4.75H11.75V9.5C11.7526 9.69811 11.8324 9.88737 11.9725 10.0275C12.1126 10.1676 12.3019 10.2474 12.5 10.25H17.25V18C17.25 18.3315 17.1183 18.6495 16.8839 18.8839C16.6495 19.1183 16.3315 19.25 16 19.25Z" />
									<path d="M13.49 14.85C12.8751 14.4642 12.4124 13.8778 12.18 13.19C12.3953 12.5467 12.4603 11.8625 12.37 11.19C12.3412 11.0206 12.2586 10.865 12.1344 10.7462C12.0102 10.6274 11.8511 10.5518 11.6806 10.5305C11.5101 10.5092 11.3372 10.5433 11.1876 10.6279C11.038 10.7125 10.9197 10.843 10.85 11C10.7362 11.8085 10.822 12.6325 11.1 13.4C10.7202 14.2873 10.2963 15.1551 9.83001 16C9.12001 16.4 8.15001 17 8.00001 17.69C7.88001 18.25 8.93001 19.69 10.72 16.57C11.5159 16.2746 12.3312 16.034 13.16 15.85C13.7727 16.2003 14.4561 16.4088 15.16 16.46C15.3216 16.4642 15.4809 16.4206 15.6178 16.3345C15.7546 16.2484 15.863 16.1238 15.9292 15.9764C15.9955 15.8289 16.0167 15.6651 15.9901 15.5056C15.9636 15.3462 15.8905 15.1981 15.78 15.08C15.36 14.65 14.11 14.77 13.49 14.85ZM8.71001 17.85C8.99025 17.3705 9.36034 16.9495 9.80001 16.61C9.12001 17.69 8.71001 17.88 8.71001 17.86V17.85ZM11.63 11.04C11.89 11.04 11.87 12.19 11.69 12.5C11.5544 12.0285 11.5338 11.5312 11.63 11.05V11.04ZM10.76 15.92C11.0988 15.3019 11.3929 14.6602 11.64 14C11.9049 14.493 12.2734 14.9229 12.72 15.26C12.0491 15.4281 11.3934 15.6522 10.76 15.93V15.92ZM15.46 15.74C15.46 15.74 15.28 15.96 14.13 15.46C15.38 15.38 15.59 15.67 15.46 15.75V15.74Z" />
								</svg>
								Print Quote</a></li>
						<?php if ($this->quote['approve_status'] == 10) { ?>
							<li><a class="quick-link" href="/mail/quote/id/<?= $this->quote['quote_id'] ?>" title="mail">
									<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path d="M19 4.25H5C4.53668 4.25263 4.09309 4.43784 3.76546 4.76546C3.43784 5.09309 3.25263 5.53668 3.25 6V18C3.25263 18.4633 3.43784 18.9069 3.76546 19.2345C4.09309 19.5622 4.53668 19.7474 5 19.75H19C19.4633 19.7474 19.9069 19.5622 20.2345 19.2345C20.5622 18.9069 20.7474 18.4633 20.75 18V6C20.7474 5.53668 20.5622 5.09309 20.2345 4.76546C19.9069 4.43784 19.4633 4.25263 19 4.25ZM5 5.75H19C19.0663 5.75 19.1299 5.77634 19.1768 5.82322C19.2237 5.87011 19.25 5.9337 19.25 6V7.54L12 11.16L4.75 7.54V6C4.75 5.9337 4.77634 5.87011 4.82322 5.82322C4.87011 5.77634 4.9337 5.75 5 5.75ZM19 18.25H5C4.9337 18.25 4.87011 18.2237 4.82322 18.1768C4.77634 18.1299 4.75 18.0663 4.75 18V9.21L11.66 12.67C11.7656 12.7228 11.882 12.7503 12 12.7503C12.118 12.7503 12.2344 12.7228 12.34 12.67L19.25 9.21V18C19.25 18.0663 19.2237 18.1299 19.1768 18.1768C19.1299 18.2237 19.0663 18.25 19 18.25Z" />
									</svg>
									Mail Quote</a></li>
						<?php } ?>
						<li><a href="/quote/delete/id/<?= $this->quote['quote_id'] ?>" title="" class='quick-link delete_quote'>
								<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
									<path d="M20 8.70007H4C3.90151 8.70007 3.80398 8.68067 3.71299 8.64298C3.62199 8.60529 3.53931 8.55005 3.46967 8.4804C3.40003 8.41076 3.34478 8.32808 3.30709 8.23709C3.2694 8.14609 3.25 8.04856 3.25 7.95007C3.25 7.85158 3.2694 7.75405 3.30709 7.66306C3.34478 7.57207 3.40003 7.48939 3.46967 7.41974C3.53931 7.3501 3.62199 7.29486 3.71299 7.25716C3.80398 7.21947 3.90151 7.20007 4 7.20007H20C20.1989 7.20007 20.3897 7.27909 20.5303 7.41974C20.671 7.5604 20.75 7.75116 20.75 7.95007C20.75 8.14899 20.671 8.33975 20.5303 8.4804C20.3897 8.62106 20.1989 8.70007 20 8.70007Z" />
									<path d="M16.44 20.75H7.56C7.24309 20.7717 6.92503 20.7303 6.62427 20.6281C6.3235 20.5259 6.04601 20.3651 5.80788 20.1548C5.56975 19.9446 5.37572 19.6892 5.23704 19.4034C5.09836 19.1177 5.01779 18.8072 5 18.49V8.00005C5 7.80113 5.07902 7.61037 5.21967 7.46972C5.36032 7.32906 5.55109 7.25005 5.75 7.25005C5.94891 7.25005 6.13968 7.32906 6.28033 7.46972C6.42098 7.61037 6.5 7.80113 6.5 8.00005V18.49C6.5 18.9 6.97 19.25 7.5 19.25H16.38C16.94 19.25 17.38 18.9 17.38 18.49V8.00005C17.38 7.78522 17.4653 7.57919 17.6172 7.42729C17.7691 7.27538 17.9752 7.19005 18.19 7.19005C18.4048 7.19005 18.6109 7.27538 18.7628 7.42729C18.9147 7.57919 19 7.78522 19 8.00005V18.49C18.9822 18.8072 18.9016 19.1177 18.763 19.4034C18.6243 19.6892 18.4303 19.9446 18.1921 20.1548C17.954 20.3651 17.6765 20.5259 17.3757 20.6281C17.075 20.7303 16.7569 20.7717 16.44 20.75ZM16.56 7.75005C16.4611 7.75139 16.363 7.73291 16.2714 7.6957C16.1798 7.65848 16.0966 7.60329 16.0267 7.53337C15.9568 7.46346 15.9016 7.38024 15.8644 7.28864C15.8271 7.19704 15.8087 7.09891 15.81 7.00005V5.51005C15.81 5.10005 15.33 4.75005 14.81 4.75005H9.22C8.67 4.75005 8.22 5.10005 8.22 5.51005V7.00005C8.22 7.19896 8.14098 7.38972 8.00033 7.53038C7.85968 7.67103 7.66891 7.75005 7.47 7.75005C7.27109 7.75005 7.08032 7.67103 6.93967 7.53038C6.79902 7.38972 6.72 7.19896 6.72 7.00005V5.51005C6.75872 4.88136 7.04203 4.29281 7.50929 3.87041C7.97655 3.44801 8.5906 3.22533 9.22 3.25005H14.78C15.4145 3.21723 16.0362 3.43627 16.51 3.8595C16.9838 4.28273 17.2713 4.87592 17.31 5.51005V7.00005C17.3113 7.09938 17.2929 7.19798 17.2558 7.29013C17.2187 7.38228 17.1637 7.46615 17.0939 7.53685C17.0241 7.60756 16.941 7.6637 16.8493 7.70201C16.7577 7.74033 16.6593 7.76006 16.56 7.76005V7.75005Z" />
									<path d="M10.22 17.0001C10.0219 16.9975 9.83263 16.9177 9.69253 16.7776C9.55244 16.6375 9.47259 16.4482 9.47 16.2501V11.7201C9.47 11.5212 9.54902 11.3304 9.68967 11.1898C9.83032 11.0491 10.0211 10.9701 10.22 10.9701C10.4189 10.9701 10.6097 11.0491 10.7503 11.1898C10.891 11.3304 10.97 11.5212 10.97 11.7201V16.2401C10.9713 16.3394 10.9529 16.438 10.9158 16.5302C10.8787 16.6223 10.8237 16.7062 10.7539 16.7769C10.6841 16.8476 10.601 16.9037 10.5093 16.9421C10.4177 16.9804 10.3193 17.0001 10.22 17.0001Z" />
									<path d="M13.78 17.0001C13.5811 17.0001 13.3903 16.9211 13.2497 16.7804C13.109 16.6398 13.03 16.449 13.03 16.2501V11.7201C13.03 11.5212 13.109 11.3304 13.2497 11.1898C13.3903 11.0491 13.5811 10.9701 13.78 10.9701C13.9789 10.9701 14.1697 11.0491 14.3103 11.1898C14.451 11.3304 14.53 11.5212 14.53 11.7201V16.2401C14.53 16.4399 14.4513 16.6317 14.3109 16.774C14.1706 16.9162 13.9798 16.9975 13.78 17.0001Z" />
								</svg>
								Delete Quote</a></li>
						<?php if ($this->quote['approve_status'] <= 0) { ?>
							<li><a href="/quote/ready/id/<?= $this->quote['quote_id'] ?>" title="" class='quick-link ready_quote'>
									<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path d="M18 20.75H6C5.27065 20.75 4.57118 20.4603 4.05546 19.9445C3.53973 19.4288 3.25 18.7293 3.25 18V6C3.25 5.27065 3.53973 4.57118 4.05546 4.05546C4.57118 3.53973 5.27065 3.25 6 3.25H14.86C15.0589 3.25 15.2497 3.32902 15.3903 3.46967C15.531 3.61032 15.61 3.80109 15.61 4C15.61 4.19891 15.531 4.38968 15.3903 4.53033C15.2497 4.67098 15.0589 4.75 14.86 4.75H6C5.66848 4.75 5.35054 4.8817 5.11612 5.11612C4.8817 5.35054 4.75 5.66848 4.75 6V18C4.75 18.3315 4.8817 18.6495 5.11612 18.8839C5.35054 19.1183 5.66848 19.25 6 19.25H18C18.3315 19.25 18.6495 19.1183 18.8839 18.8839C19.1183 18.6495 19.25 18.3315 19.25 18V10.29C19.25 10.0911 19.329 9.90032 19.4697 9.75967C19.6103 9.61902 19.8011 9.54 20 9.54C20.1989 9.54 20.3897 9.61902 20.5303 9.75967C20.671 9.90032 20.75 10.0911 20.75 10.29V18C20.75 18.7293 20.4603 19.4288 19.9445 19.9445C19.4288 20.4603 18.7293 20.75 18 20.75Z" />
										<path d="M10.5 15.25C10.3071 15.2352 10.1276 15.1455 10 15L7.00001 12C6.93317 11.86 6.91136 11.7028 6.93759 11.5499C6.96382 11.3971 7.03679 11.2561 7.14646 11.1464C7.25613 11.0368 7.3971 10.9638 7.54996 10.9376C7.70282 10.9113 7.86006 10.9331 8.00001 11L10.47 13.47L19 4.99998C19.14 4.93314 19.2972 4.91133 19.4501 4.93756C19.6029 4.96379 19.7439 5.03676 19.8536 5.14643C19.9632 5.2561 20.0362 5.39707 20.0624 5.54993C20.0887 5.70279 20.0669 5.86003 20 5.99998L11 15C10.8724 15.1455 10.693 15.2352 10.5 15.25Z" />
									</svg>
									Submit Approval</a></li>
						<?php } ?>
						<?php if ($this->quote['approve_status'] == 10) { ?>
							<li><a href="/quote/disapprove/id/<?= $this->quote['quote_id'] ?>" title="" class='quick-link disapprove_quote'>
									<svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
										<path d="M8 18.75H6.5C5.81 18.75 5.25 18.19 5.25 17.5V5.5C5.25 4.81 5.81 4.25 6.5 4.25H10.25V9C10.25 9.41 10.59 9.75 11 9.75H15.8C15.9 10.04 16.17 10.25 16.5 10.25C16.91 10.25 17.25 9.91 17.25 9.5V9C17.25 8.9 17.23 8.8 17.19 8.71C17.15 8.62 17.1 8.54 17.03 8.47L11.53 2.97C11.46 2.9 11.38 2.85 11.29 2.81C11.2 2.77 11.1 2.75 11 2.75H6.5C4.98 2.75 3.75 3.98 3.75 5.5V17.5C3.75 19.02 4.98 20.25 6.5 20.25H8C8.41 20.25 8.75 19.91 8.75 19.5C8.75 19.09 8.41 18.75 8 18.75ZM11.75 5.31L14.69 8.25H11.75V5.31ZM19.61 11.37C19.23 10.99 18.67 10.76 18.09 10.75C17.49 10.72 16.92 10.95 16.54 11.34L10.15 17.74C10.02 17.87 9.95 18.03 9.93 18.21L9.75 20.44C9.73 20.66 9.81 20.88 9.97 21.03C10.11 21.17 10.3 21.25 10.5 21.25C10.52 21.25 10.54 21.25 10.57 21.25L12.82 21.04C12.99 21.02 13.16 20.95 13.28 20.82L19.67 14.42C20.47 13.63 20.44 12.2 19.61 11.37ZM18.61 13.36L12.41 19.57L11.32 19.67L11.4 18.61L17.6 12.4C17.7 12.3 17.88 12.26 18.06 12.25C18.26 12.25 18.44 12.32 18.55 12.43C18.79 12.66 18.82 13.15 18.61 13.36Z" />
									</svg>
									Edit Again</a></li>
						<?php } ?>
					</ol>
				</div>
			</div>
		</nav>
		<aside>
</div>

<script type="text/javascript">
	$("textarea").each(function() {
		this.setAttribute("style", "height:" + (this.scrollHeight) + "px;overflow-y:hidden;");
	}).on("input", function() {
		this.style.height = 0;
		this.style.height = (this.scrollHeight) + "px";
	});

	function resetForm($form) {
		$form.find('input:text, input:password, input:file, select, textarea').val('');
		$form.find('input:radio, input:checkbox')
			.prop('checked', false).prop('selected', false);
		$form.find('#sort').val(getmaxsort());
	}

	function getmaxsort() {
		var sorts = [];
		$("#item_body .sorts").each(function(index) {
			sorts.push($(this).val());
		});

		console.log(sorts);
		if (sorts == null) {
			return 0;
		} else {
			return Math.max.apply(Math, sorts) + 1;
		}

	}

	var current_edit_row = '';

	$(function() {

		$("#dialog-message").dialog({
			autoOpen: false,
			modal: true,
			width: 800,
			buttons: {
				OK: function() {
					if ($("#item").validationEngine('validate') == true) {
						if ($('#is_edit').val() == 1) {
							edititem($('#item_id').val(), $('#item_input').val(), $('#uom').val(), $('#price').val(), $('#qty').val(), $('#note').val(), $('#sort').val());
						} else {
							additem($('#item_id').val(), $('#item_input').val(), $('#uom').val(), $('#price').val(), $('#qty').val(), $('#sort').val());
						}
						$(this).dialog("close");
						resetForm($('#item'));

					}
				}
			}
		});

		$('#opener').on("click", function() {
			resetForm($('#item'));
			$('#is_edit').val(0);
			return false;
		});

		$(document).on("click", "a.edit", function() {
			$("#dialog-message").dialog("open");
			current_edit_row = $(this).closest('tr');
			set_edit(current_edit_row);
			return false;
		});

		function set_edit(row) {
			$("#dialog-message").dialog("option", "title", "Edit Item");
			$('#is_edit').val(1);
			var item_id = $(row).attr('name').substr(5, ($(row).attr('name').length - 6));
			var item_name = ($(row).find('td').eq(1).clone().children().remove().end().text()).trim().replace(item_id + ' - ', '');
			var note = $(row).find('textarea').eq(0).val();
			var qty = $(row).find(':input:hidden').eq(0).val();
			var unit_price = $(row).find(':input:hidden').eq(1).val();
			var uom = $(row).find(':input:hidden').eq(2).val();
			var total_price = $(row).find(':input:hidden').eq(3).val();
			var sort = $(row).find(':input:hidden').eq(4).val();

			$('#item #item_input').val(item_name);
			$('#item #item_id').val(item_id);

			$('#item #price').val(unit_price);
			$('#item #qty').val(qty);
			$('#item #note').val(note);
			$('#item #sort').val(sort);

			getoumedit(item_id, uom, unit_price);

		}

		function getoumedit(item_id, unit_number, price) {
			$('.loading').show();
			$.ajax({
				url: '/item/uom/id/' + $("#item_id ").val(),
				type: "get",
				success: function(data) {
					var uom = JSON.parse(data);
					var list = '';
					$.each(uom, function(i, item) {
						list = list + '<option value="' + item.uom + '">' + item.uom + '</option>';
					});
					$('#uom').html(list);
					$('#uom option[value=' + unit_number + ']').attr('selected', 'selected');
					$('#uniform-uom span').html(unit_number);
					$('#price').val(price);
					$('.loading').hide();
				}
			});

		}

		function edititem(item_id, item_desc, uom, price, qty, note, sort) {
			var total_price = (price * qty).toFixed(2);
			var str = '<tr name="item[' + item_id + ']">' + '<td><input type="checkbox"' + 'name="item[' + item_id + ']"/></td>' + '<td>' + item_id + '<br/>' + item_desc + '<br/><textarea rows="1" cols="" name="item[' + item_id + '][note][]">' + note + '</textarea></td>' + '<td>' + qty + '</td>' + '<td>' + price + '</td>' + '<td>' + uom + '</td>' + '<td>' + total_price + '</td>' +
				'<input type="hidden" name="item[' + item_id + '][qty][]" value="' + qty + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][unit_price][]" value="' + price + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][uom][]" value="' + uom + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][total_price][]" value="' + total_price + '"/>' +
				'<input type="hidden" class="sorts" name="item[' + item_id + '][sort][]" value="' + sort + '"/>' +
				'<td><a class="edit" href="#"><img src="/images/icons/dark/pencil.png" alt="edit"></a><a class="delete" href="#"><img src="/images/icons/dark/close.png" alt="delete"></a></td>';

			current_edit_row.replaceWith(str);

		}

		$(".dialog #item_input").autocomplete({
			source: '/item/index/',
			minLength: 2,
			focus: function(event, ui) {
				$("#item_input").val(ui.item.item_desc);
				return false;
			},
			select: function(event, ui) {
				$("#item_input").val(ui.item.item_desc);
				$("#item_id ").val(ui.item.item_id);
				getoum(ui.item.item_id);
				$('#uom').prop('disabled', false);
				$('#uniform-uom').removeClass('disabled');
				return false;
			}
		}).data("ui-autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>" + item.item_id + "<br>" + item.item_desc + "</a>")
				.appendTo(ul);
		};

		function getoum(item_id) {
			$('.loading').show();
			$.ajax({
				url: '/item/uom/id/' + $("#item_id ").val(),
				type: "get",
				success: function(data) {
					var uom = JSON.parse(data);
					var list = '';
					$.each(uom, function(i, item) {
						list = list + '<option value="' + item.uom + '">' + item.uom + '</option>';
					});
					$('#uom').html(list);
					$('#uom option').eq(0).attr("selected", "selected");
					$('#uniform-uom span').html(uom[0].uom);
					getprice();
					$('.loading').hide();
				}
			});

		}

		function getprice() {
			$('.loading').show();
			$.ajax({
				url: '/item/price/id/' + $("#item_id ").val() + '/uom/' + $("#uom ").val(),
				type: "get",
				success: function(data) {
					var price = JSON.parse(data);
					$('#price').val(price.price);
					$('.loading').hide();
				}
			});

		}

		function additem(item_id, item_desc, uom, price, qty, sort) {
			var total_price = (price * qty).toFixed(2);
			var str = '<tr name="item[' + item_id + ']">' + '<td><input type="checkbox"' + 'name="item[' + item_id + ']"/></td>' + '<td>' + item_id + '<br/>' + item_desc + '<br/><textarea rows="1" cols="" name="item[' + item_id + '][note][]"></textarea></td>' + '<td>' + qty + '</td>' + '<td>' + price + '</td>' + '<td>' + uom + '</td>' + '<td>' + total_price + '</td>' +
				'<input type="hidden" name="item[' + item_id + '][qty][]" value="' + qty + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][unit_price][]" value="' + price + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][uom][]" value="' + uom + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][total_price][]" value="' + total_price + '"/>' +
				'<input type="hidden" class="sorts" name="item[' + item_id + '][sort][]" value="' + sort + '"/>' +
				'<td><a class="edit" href="#"><img src="/images/icons/dark/pencil.png" alt="edit"></a><a class="delete" href="#"><img src="/images/icons/dark/close.png" alt="delete"></a></td>';

			$('#item_body').append(str);

		}

		function getcustomerbyid(id) {
			$('.loading').show();
			$.ajax({
				url: '/customer/fetchbyid/id/' + id,
				type: "get",
				success: function(data) {
					var result = JSON.parse(data);
					if (result != null) {
						$('#quote').val(result.name);
						$('#customer_id').val(id);
						$('#address').val(result.phys_address1 + ' ' + result.phys_address2 + ' ' + result.phys_city + ' ' + result.mail_state + ' ' + result.phys_country + ' ' + result.mail_postal_code);
						$('#tel').val(result.tel);
						$('#contact').val(result.first_name + ' ' + result.last_name);
						$('#customer_email').val(result.email);
						$('#sale_rep').val(result.sale_rep);

					} else {
						alert('Can\'t find customer');
						$('#customer_info input').val('');
					}
					$('.loading').hide();
				}
			});
		}
		$('#add_new_mode').on("click", function() {
			$('#quote,#address, #tel').prop('readonly', false).val('');
			$('#customer_id').attr('readonly', 'readonly').val('');
			$('#contact,#customer_email').val('');
			$('#quote, #address, #tel,#customer_email').addClass('validate[required]');
			$('#add_new_mode').hide();
			$('#discard_new_mode').show();
		});
		$('#discard_new_mode').on("click", function() {
			$('#address, #tel').attr('readonly', 'readonly').val('');
			$('#quote').val('');
			$('#customer_id').prop('readonly', false).val('');
			$('#contact,#customer_email').val('');
			$('#quote, #address, #tel,#customer_email').removeClass('validate[required]');
			$('#add_new_mode').show();
			$('#discard_new_mode').hide();
		});

		$("#uom,#uniform-uom").on("change", function() {
			getprice();
			return false;
		});

		$(document).on("click", "#item_body .delete", function(e) {
			$(this).parent().parent().remove();
			e.preventDefault();
		});

		$("#customer_email").autocomplete({
			source: "/customer/email/",
			minLength: 2,
			select: function(event, ul) {
				getcustomerbyid(ul.item.customer_id);
			}
		}).data("ui-autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>" + item.email + "<br>" + item.first_name + ' ' + item.last_name + "</a>")
				.appendTo(ul);
		};
		$("#quote").autocomplete({
			source: "/customer/quote/",
			minLength: 2,
			select: function(event, ul) {
				getcustomerbyid(ul.item.customer_id);
			}
		}).data("ui-autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>Company: " + item.name + "<br>" + item.fullname + ' ' + item.city + ' ' + item.tel + "</a>")
				.appendTo(ul);
		};
		$("#contact").autocomplete({
			source: "/customer/name/",
			minLength: 2,
			select: function(event, ul) {
				getcustomerbyid(ul.item.customer_id);
			},

		}).data("ui-autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>Company: " + item.name + "<br>" + item.fullname + ' ' + item.city + ' ' + item.tel + "</a>")
				.appendTo(ul);
		};

		$('a.save_quote').on("click", function(e) {
			e.preventDefault();
			if ($("#quote_content").validationEngine('validate') == true) {
				$('.loading').show();
				$('#quote_content').submit();
			}
		});
		$('a.delete_quote').on("click", function(e) {
			if (confirm("Confirm delete This Quote?") == true) {

			} else {
				e.preventDefault();
			}
		});

		$('a.ready_quote').on("click", function(e) {
			if (confirm("Click OK to submit quote without changes.\nClick CANCEL to return to edit.") == true) {
				e.preventDefault();
				$('.loading').show();
				$.ajax({
					url: "/quote/ready/id/<?= $this->quote['quote_id'] ?>",
					type: "get",
					success: function(data) {
						$('#status').html('<div class="nNote nInformation hideit"><p><strong>INFORMATION: </strong>Your Quote is Waiting for Approval.</p></div>');
						$('a.ready_quote').hide();
					}
				});
				$('.loading').hide();
			} else {
				e.preventDefault();
			}
		});

		$('a.disapprove_quote').on("click", function(e) {
			if (confirm("You need submit again after edit!") == true) {
				e.preventDefault();
				$('.loading').show();
				$.ajax({
					url: "/quote/disapprove/id/<?= $this->quote['quote_id'] ?>",
					type: "get",
					success: function(data) {
						$('#status').html('<div class="nNote nInformation hideit"><p><strong>INFORMATION: </strong>You Need submit again after edit</p></div>');
						location.reload();
					}
				});
				$('.loading').hide();
			} else {
				e.preventDefault();
			}
		});



	});
</script>