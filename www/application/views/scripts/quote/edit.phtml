<?php $session =  Zend_Registry::get('session'); ?>

<!-- Left panel -->
<div class="sidebar-container">
	<div class="toc-container">
		<aside class="toc">
			<nav>
				<div class="document-toc-container">
					<section class="document-toc">
						<header>
							<h2 class="document-toc-heading">On this page</h2>
						</header>
						<ul id="document-toc-list" class="document-toc-list"></ul>
					</section>
				</div>
			</nav>
		</aside>
		<section class="place side"></section>
	</div>
</div>

<!-- Title area -->
<?php $project = $this->project; ?>
<main id="content" class="main-content">
	<div class="middleNav">
		<ul>
			<li class="mUser"><a href="#" title="Share"><span class="users"></span></a>
				<ul class="mSub1">
					<li><a href="#" title="">Share user</a></li>
					<li><a href="#" title="">Show Teamworks</a></li>
				</ul>
			</li>

			<li class="mOrders"><a href="#" title="Change Status"><span class="files"></span></a>
				<ul class="mSub4">
					<li><a href="#" title="">Add</a></li>
					<li><a href="#" title="">Save</a></li>
					<li><a href="#" title="">Edit</a></li>
					<li><a href="#" title="">Delete</a></li>
				</ul>
			</li>
		</ul>
	</div>

	<div class="main-page-content">
		<header class="main-page-content-header">
			<h1>Price Quote</h1>
		</header>
		<!-- Page statistics area -->
		<!-- <div class="statsRow">
        <div class="wrapper">
        	<div class="controlB">
            	<ul>
                	<!--<li><a href="/quote/index/project/<?= $project['project_id'] ?>" title=""><img src="/images/icons/control/32/plus.png" alt="" /><span>Add New Quote</span></a></li>-->
		<!--<li><a href="#" title=""><img src="/images/icons/control/32/doc_edit.png" alt="" /><span>Edit Current</span></a></li>
                    <li><a href="#" title=""><img src="/images/icons/control/32/refresh.png" alt="" /><span>Update Quote</span></a></li>
                    <?php if ($this->quote['approve_status'] != 10) { ?>
                    <li><a href="#" title="save" class='save_quote'><img src="/images/icons/control/32/save.png" alt="save" /><span>Save Quote</span></a></li>
                    <?php } ?>
                    <li><a href="<?= 'http://' . SITEURL . "/dompdf/print.php?url=" . 'http://' . SITEURL . "/quote/print/id/" . $this->quote['quote_id'] . "?company=" . substr($this->quote['quote_no'], 0, 3) . "&name=Centura_Quote_" . $this->quote['quote_id'] . '.pdf' ?>" title="print"><img src="/images/icons/control/32/pdf.png" alt="" /><span>Print Quote</span></a></li>
                    <?php if ($this->quote['approve_status'] == 10) { ?>
                    <li><a href="/mail/quote/id/<?= $this->quote['quote_id'] ?>" title="mail"><img src="/images/icons/control/32/mail.png" alt="" /><span>Mail Quote</span></a></li>
                  	<?php } ?>
                    <!--<li><a href="/quote/delete/id/<?= $this->quote['quote_id'] ?>" title="" class='delete_quote'><img src="/images/icons/control/32/delete.png" alt="" /><span>Delete Quote</span></a></li>
                    <?php if ($this->quote['approve_status'] <= 0) { ?>
                    	<li><a href="/quote/ready/id/<?= $this->quote['quote_id'] ?>" title="" class='ready_quote'><img src="/images/icons/control/32/order-149.png" alt="" /><span>Submit Quote For Approval</span></a></li>
                    <?php } ?>
                    <?php if ($this->quote['approve_status'] == 10) { ?>
                    	<li><a href="/quote/disapprove/id/<?= $this->quote['quote_id'] ?>" title="" class='disapprove_quote'><img src="/images/icons/control/32/refresh.png" alt="" /><span>Edit Again</span></a></li>
                    <?php } ?>
                </ul>
                <div class="clear"></div>
            </div>
        </div>
    </div> -->

		<!-- Main content wrapper -->
		<section aria-labelledby="project-information" id="section1" data-nav="Project information" class="active">
			<h2>Project information</h2>
				<div class="widget-information">
					<div class="widget-table">
					<div class="project-information">
						<p>Project Name: <b><?= $project['project_name'] ?></b><br>
							Project Quote No: <b><?= $project['quote_no'] ?></b><br>
							Worksheet Owner: <b><?= $project['owner'] ?></b><br>
							Status: <b><?= $project['status_name'] ?></b><br>
							Due Date: <b><?= $project['due_date']->format('Y-m-d') ?></b>
						</p>
					</div>
					</div>
					<div class="widget-table">
					<div id="status">
						<?php if ($this->quote['approve_status'] == 1) { ?>
							<div class="nNote nInformation hideit">
								<p><strong>INFORMATION: </strong>Your quote is waiting for approval.</p>
							</div>
						<?php } ?>
						<?php if ($this->quote['approve_status'] == 10) { ?>
							<div class="nNote nSuccess hideit">
								<p><strong>INFORMATION: </strong>Your quote has been approved.</p>
							</div>
						<?php } ?>
						<?php if ($this->quote['approve_status'] == -1) { ?>
							<div class="nNote nFailure hideit">
								<p><strong>INFORMATION: </strong>Your quote is disapproved.</p>
							</div>
						<?php } ?>
					</div>
						</div>
				</div>
		</section>

		<!-- Form -->
		<form method='post' class="form" id="quote_content">
			<section aria-labelledby="customer-information" id="section2" data-nav="Customer information">
				<h2>Customer infomation</h2>
				<div class="widget-table" id="customer_info">
					<a href="javascript:void(0)" title="" class="button greenB" style="margin: 2px;" id="add_new_mode"><span>New Customer</span></a>
					<a href="javascript:void(0)" title="" class="button basic" style='display:none;' style="margin: 2px;" id="discard_new_mode"><span>Discard Adding</span></a>
					<input type="hidden" name='project_id' value="<?= $project['project_id'] ?>" />
					<div class="formRow">
						<div class="oneTwo required-field">
							<label for="quote"><b>Quote To</b></label>
							<input type="text" value="<?= $this->customer['name'] ?>" id='quote' name='name' />
						</div>

						<div class="oneTwo required-field">
							<label for="address"><b>Address</b></label>
							<input type="text" value="<?= $this->customer['phys_address1'] ?>" id='address' name='phys_address1' readonly />
						</div>
						<div class="oneTwo required-field">
							<label for="tel"><b>Tel</b></label>
							<input type="text" id='tel' name='phone' class="maskPhoneExt" value="<?= $this->customer['tel'] ?>" id='tel' name='tel' readonly />
						</div>
						<div class="oneTwo required-field">
							<label for="customer_id"><b>ID</b></label>
							<input name='customer_id' type="text" id='customer_id' class="validate[custom[integer]]" value="<?= $this->customer['customer_id'] ?>" placeholder="Leave blank for add new customer" readonly />
						</div>
						<div class="oneTwo required-field">
							<label for="contact"><b>Contact</b></label>
							<input type="text" id='contact' name='fullname' value="<?= $this->customer['fullname'] ?>" class="validate[required]" placeholder="Enter Customer Name to fetch existing customer" />
						</div>
						<div class="oneTwo required-field">
							<label for="customer_email"><b>Email</b></label>
							<input type="text" value="<?= $this->customer['email'] ?>" id='customer_email' name='Contacts_email' class="validate[custom[email]]" placeholder="Enter Customer Email to fetch existing customer">
						</div>
					</div>
				</div>
			</section>

			<section aria-labelledby="quote-information" id="section3" data-nav="Quote information">
				<h2>Quote infomation</h2>
				<div class="widget-table">
					<div class="formRow">
						<div class="oneTwo">
							<label for="quote-number" class="formNote"><b>Quote number</b></label>
							<input id="quote-number" type="text" value='<?= $this->quote['quote_id'] ?>' readonly />
						</div>
						<div class="oneTwo">
							<label for="quote-date" class="formNote"><b>Quote date</b></label>
							<input id="quote-date" type="text" class="datepicker" value="<?= $this->quote['quote_date']->format('Y-m-d') ?>" />
						</div>
						<div class="oneTwo">
							<label for='ship_required_date' class="formNote"><b>Ship required date</b></label>
							<input id='ship_required_date' type="text" class="datepicker" name='ship_required_date' value="<?php if ($this->quote['ship_required_date'] != null && $this->quote['ship_required_date']->format('Y-m-d') > '2000-01-01') {
																																echo $this->quote['ship_required_date']->format('Y-m-d');
																															} ?>" />
						</div>
						<div class="oneTwo">
							<label for='quote_type' class="formNote"><b>Quote type</b></label>
							<select name="quote_type_id" id='quote_type' class="validate[required]">
								<option value="">Select Quote type</option>
								<?php foreach ($this->type as $t) { ?>
									<option value="<?= $t['uid'] ?>" <?php if ($t['uid'] == $this->quote['quote_type_id']) echo 'selected'; ?>><?= $t['type'] ?></option>
								<?php } ?>
							</select>
						</div>

						<div class="oneTwo">
							<label for="project-name" class="formNote"><b>Project name</b></label>
							<input id="project-name" type="text" value="<?= $project['project_name'] ?>" readonly />
						</div>

						<div class="oneTwo">
							<label for="project-location" class="formNote"><b>Project location</b></label>
							<input id="project-location" type="text" value="<?= $project['project_location_address'] ?>" readonly />
						</div>

						<div class="oneTwo">
							<label for='sale_rep' class="formNote"><b>Sale rep</b></label>
							<input id='sale_rep' name='sale_rep' type="text" value="<?= $this->quote['sales_id'] ?>" readonly />
						</div>

						<div class="oneTwo required-field">
							<label for='arch' class="formNote"><b>Arch rep.</b></label>
							<select id='arch' name='arch' class="validate[required]">
								<?php if ($session->user['approve_id'] != null) { ?>
									<?php foreach ($this->arch as $a) { ?>
										<option value="<?= $a['id'] ?>" <?php if ($a['id'] == $this->quote['arch']) echo 'selected'; ?>><?= $a['name'] . ' - ' . $a['default_company'] ?></option>
									<?php } ?>
								<?php } else { ?>
									<?php foreach ($this->arch as $a) { ?>
										<?php if ($a['id'] == $this->quote['arch']) { ?><option value="<?= $a['id'] ?>" selected><?= $a['name'] . ' - ' . $a['default_company'] ?></option> <?php } ?>
									<?php } ?>
								<?php } ?>
							</select>
						</div>
						<input type="hidden" name="sales_id" value="<?= $session->user['id'] ?>"" />
                        
                        
							<div class=" oneTwo required-field">
						<label for='Segment' class="formNote"><b>Segment</b></label>
						<input type="text" class="validate[required]" id='Segment' placeholder="123456-" name='quote_segment' value='<?= $this->quote['quote_segment'] ?>' />
					</div>

					<div class="oneTwo required-field">
						<label for="quote_approval" class="formNote"><b>Quote approval</b></label>
						<select id="quote_approval">
							<?php foreach ($this->approval as $a) {
								if ($a['uid'] == $this->quote['quote_approval']) { ?>
									<option value="
												<?= $a['uid'] ?>" selected><?= $a['Name'] . ' - ' . $a['Company_ID'] ?>
									</option>
							<?php }
							} ?>
						</select>
					</div>

				</div>
	</div>
	</section>

	<section aria-labelledby="items" id="section4" data-nav="Items">
		<h2>Items</h2>
		<div class="widget-table">
			<a href="#" title="" class="button greenB" style="margin: 5px;" id="opener"><span>Add new Item</span></a>
			<table cellpadding="0" cellspacing="0" width="100%" class="sTable" id="items" style="text-align:center;">
				<thead>
					<tr>
						<td></td>
						<td width="60%">Item ID - Description</td>
						<td>Quality Quoted</td>
						<td>Unit Price</td>
						<td>Unit Of Measure</td>
						<td>Price Quoted</td>
						<td>Action</td>
					</tr>
				</thead>
				<tbody id="item_body">
					<?PHP foreach ($this->items as $i) { ?>
						<tr name="item[<?= $i['product_id'] ?>]">
							<td><input type="checkbox" name="item[<?= $i['product_id'] ?>]"></td>
							<td><?= $i['product_id'] ?> - <?= $i['item_desc'] ?>
								<textarea rows="1" cols="" name="item[<?= $i['product_id'] ?>][note][]"><?= $i['note'] ?></textarea>
							</td>
							<td><?= $i['qty'] ?></td>
							<td><?= $i['unit_price'] ?></td>
							<td><?= $i['uom'] ?></td>
							<td><?= $i['subtotal'] ?></td>
							<input type="hidden" name="item[<?= $i['product_id'] ?>][qty][]" value="<?= $i['qty'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][unit_price][]" value="<?= $i['unit_price'] ?>">
							<input type="hidden" name="item[<?= $i['product_id'] ?>][uom][]" value="<?= $i['uom'] ?>"><input type="hidden" name="item[<?= $i['product_id'] ?>][total_price][]" value="<?= $i['subtotal'] ?>">
							<input type="hidden" class='sorts' name="item[<?= $i['product_id'] ?>][sort][]" value="<?= $i['sort_id'] ?>">
							<td><a class="edit" href="#"><img src="/images/icons/dark/pencil.png" alt="edit"></a><a class="delete" href="#"><img src="/images/icons/dark/close.png" alt="delete"></a></td>

						</tr>
					<?PHP } ?>
				</tbody>
			</table>
		</div>
	</section>

	<section aria-labelledby="comment" id="section5" data-nav="Comment">
		<h2>Comment</h2>
		<div class="widget-table">
			<div class="formRow">
				<div class="oneTwo">
					<label>Quote Note:</label>
					<textarea rows="8" cols="" name="note" placeholder="Note Area"><?= $this->quote['note'] ?></textarea>
				</div>
			</div>
		</div>
	</section>
	</form>

	<div id="dialog-message" title="Add Item">
		<div class="uiForm">
			<form action="" class="dialog" id='item'>
				<span class="formNote">Enter Item ID </span>
				<input type="text" name="item" id='item_input' class="validate[required]" />
				<input type="hidden" id="item_id" />
				<span class="formNote">UOM</span>
				<select name="uom" id='uom' class="validate[required]">
					<option value=''>Select UOM</option>
				</select>
				<div class="clear"></div>
				<span class="formNote">Price ($)</span>
				<input type="text" class="validate[required,custom[number]]" name="price" id='price' placeholder="You can override the price" />
				<span class="formNote">Qty</span>
				<input type="text" name="qty" id='qty' class="validate[required]" />
				<input type="hidden" id="is_edit" value='0' />
				<input type="hidden" id="note" value='' />
				<input type="hidden" id="sort" value='' />
			</form>
		</div>
	</div>
	</div>
</main>

<!-- Right panel -->
<div>
	<div class="statsRow">
		<div class="wrapper">
			<div class="controlB">
				<ul>
					<li><a href="/quote/index/project/<?= $project['project_id'] ?>" title=""><img src="/images/icons/control/32/plus.png" alt="" /><span>Add New Quote</span></a></li>
					<!--<li><a href="#" title=""><img src="/images/icons/control/32/doc_edit.png" alt="" /><span>Edit Current</span></a></li>
                    <li><a href="#" title=""><img src="/images/icons/control/32/refresh.png" alt="" /><span>Update Quote</span></a></li>-->
					<?PHP if ($this->quote['approve_status'] != 10) { ?>
						<li><a href="#" title="save" class="save_quote"><img src="/images/icons/control/32/save.png" alt="save" /><span>Save Quote</span></a></li>
					<?php } ?>
					<li><a href="<?= 'http://' . SITEURL . "/dompdf/print.php?url=" . 'http://' . SITEURL . "/quote/print/id/" . $this->quote['quote_id'] . "?company=" . substr($this->quote['quote_no'], 0, 3) . "&name=Centura_Quote_" . $this->quote['quote_id'] . '.pdf' ?>" title="print"><img src="/images/icons/control/32/pdf.png" alt="" /><span>Print Quote</span></a></li>
					<?php if ($this->quote['approve_status'] == 10) { ?>
						<li><a href="/mail/quote/id/<?= $this->quote['quote_id'] ?>" title="mail"><img src="/images/icons/control/32/mail.png" alt="" /><span>Mail Quote</span></a></li>
					<?php } ?>
					<li><a href="/quote/delete/id/<?= $this->quote['quote_id'] ?>" title="" class='delete_quote'><img src="/images/icons/control/32/delete.png" alt="" /><span>Delete Quote</span></a></li>
					<?php if ($this->quote['approve_status'] <= 0) { ?>
						<li><a href="/quote/ready/id/<?= $this->quote['quote_id'] ?>" title="" class='ready_quote'><img src="/images/icons/control/32/order-149.png" alt="" /><span>Submit Approval</span></a></li>
					<?php } ?>
					<?php if ($this->quote['approve_status'] == 10) { ?>
						<li><a href="/quote/disapprove/id/<?= $this->quote['quote_id'] ?>" title="" class='disapprove_quote'><img src="/images/icons/control/32/refresh.png" alt="" /><span>Edit Again</span></a></li>
					<?php } ?>
				</ul>
				<div class="clear"></div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	const items = ["Project information", "Customer information", "Quote information", "Items", "Comment"];
	createTocList(items);

	function resetForm($form) {
		$form.find('input:text, input:password, input:file, select, textarea').val('');
		$form.find('input:radio, input:checkbox')
			.removeAttr('checked').removeAttr('selected');
		$form.find('#sort').val(getmaxsort());
	}

	function getmaxsort() {
		var sorts = [];
		$("#item_body .sorts").each(function(index) {
			sorts.push($(this).val());
		});

		console.log(sorts);
		if (sorts == null) {
			return 0;
		} else {
			return Math.max.apply(Math, sorts) + 1;
		}

	}

	var current_edit_row = '';

	$(function() {

		$("#dialog-message").dialog({
			autoOpen: false,
			modal: true,
			buttons: {
				Ok: function() {
					if ($("#item").validationEngine('validate') == true) {
						if ($('#is_edit').val() == 1) {
							edititem($('#item_id').val(), $('#item_input').val(), $('#uom').val(), $('#price').val(), $('#qty').val(), $('#note').val(), $('#sort').val());
						} else {
							additem($('#item_id').val(), $('#item_input').val(), $('#uom').val(), $('#price').val(), $('#qty').val(), $('#sort').val());
						}
						$(this).dialog("close");
						resetForm($('#item'));

					}
				}
			}
		});

		$('#opener').on("click", function() {
			resetForm($('#item'));
			$('#is_edit').val(0);
			return false;
		});

		$(document).on("click", "a.edit", function() {
			$("#dialog-message").dialog("open");
			current_edit_row = $(this).closest('tr');
			set_edit(current_edit_row);
			return false;
		});

		function set_edit(row) {
			$("#dialog-message").dialog("option", "title", "Edit Item");
			$('#is_edit').val(1);
			var item_id = $(row).attr('name').substr(5, ($(row).attr('name').length - 6));
			var item_name = jQuery.trim($(row).find('td').eq(1).clone().children().remove().end().text()).replace(item_id + ' - ', '');
			var note = $(row).find('textarea').eq(0).val();
			var qty = $(row).find(':input:hidden').eq(0).val();
			var unit_price = $(row).find(':input:hidden').eq(1).val();
			var uom = $(row).find(':input:hidden').eq(2).val();
			var total_price = $(row).find(':input:hidden').eq(3).val();
			var sort = $(row).find(':input:hidden').eq(4).val();

			$('#item #item_input').val(item_name);
			$('#item #item_id').val(item_id);

			$('#item #price').val(unit_price);
			$('#item #qty').val(qty);
			$('#item #note').val(note);
			$('#item #sort').val(sort);

			getoumedit(item_id, uom, unit_price);

		}

		function getoumedit(item_id, unit_number, price) {
			$('.loading').show();
			$.ajax({
				url: '/item/uom/id/' + $("#item_id ").val(),
				type: "get",
				success: function(data) {
					var uom = jQuery.parseJSON(data);
					var list = '';
					$.each(uom, function(i, item) {
						list = list + '<option value="' + item.uom + '">' + item.uom + '</option>';
					});
					$('#uom').html(list);
					$('#uom option[value=' + unit_number + ']').attr('selected', 'selected');
					$('#uniform-uom span').html(unit_number);
					$('#price').val(price);
					$('.loading').hide();
				}
			});

		}

		function edititem(item_id, item_desc, uom, price, qty, note, sort) {
			var total_price = (price * qty).toFixed(2);
			var str = '<tr name="item[' + item_id + ']">' + '<td><input type="checkbox"' + 'name="item[' + item_id + ']"/></td>' + '<td>' + item_id + '<br/>' + item_desc + '<br/><textarea rows="1" cols="" name="item[' + item_id + '][note][]">' + note + '</textarea></td>' + '<td>' + qty + '</td>' + '<td>' + price + '</td>' + '<td>' + uom + '</td>' + '<td>' + total_price + '</td>' +
				'<input type="hidden" name="item[' + item_id + '][qty][]" value="' + qty + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][unit_price][]" value="' + price + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][uom][]" value="' + uom + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][total_price][]" value="' + total_price + '"/>' +
				'<input type="hidden" class="sorts" name="item[' + item_id + '][sort][]" value="' + sort + '"/>' +
				'<td><a class="edit" href="#"><img src="/images/icons/dark/pencil.png" alt="edit"></a><a class="delete" href="#"><img src="/images/icons/dark/close.png" alt="delete"></a></td>';

			current_edit_row.replaceWith(str);

		}

		$(".dialog #item_input").autocomplete({
			source: '/item/index/',
			minLength: 2,
			focus: function(event, ui) {
				$("#item_input").val(ui.item.item_desc);
				return false;
			},
			select: function(event, ui) {
				$("#item_input").val(ui.item.item_desc);
				$("#item_id ").val(ui.item.item_id);
				getoum(ui.item.item_id);
				$('#uom').removeAttr('disabled');
				$('#uniform-uom').removeClass('disabled');
				return false;
			}
		}).data("autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>" + item.item_id + "<br>" + item.item_desc + "</a>")
				.appendTo(ul);
		};

		function getoum(item_id) {
			$('.loading').show();
			$.ajax({
				url: '/item/uom/id/' + $("#item_id ").val(),
				type: "get",
				success: function(data) {
					var uom = jQuery.parseJSON(data);
					var list = '';
					$.each(uom, function(i, item) {
						list = list + '<option value="' + item.uom + '">' + item.uom + '</option>';
					});
					$('#uom').html(list);
					$('#uom option').eq(0).attr("selected", "selected");
					$('#uniform-uom span').html(uom[0].uom);
					getprice();
					$('.loading').hide();
				}
			});

		}

		function getprice() {
			$('.loading').show();
			$.ajax({
				url: '/item/price/id/' + $("#item_id ").val() + '/uom/' + $("#uom ").val(),
				type: "get",
				success: function(data) {
					var price = jQuery.parseJSON(data);
					$('#price').val(price.price);
					$('.loading').hide();
				}
			});

		}

		function additem(item_id, item_desc, uom, price, qty, sort) {
			var total_price = (price * qty).toFixed(2);
			var str = '<tr name="item[' + item_id + ']">' + '<td><input type="checkbox"' + 'name="item[' + item_id + ']"/></td>' + '<td>' + item_id + '<br/>' + item_desc + '<br/><textarea rows="1" cols="" name="item[' + item_id + '][note][]"></textarea></td>' + '<td>' + qty + '</td>' + '<td>' + price + '</td>' + '<td>' + uom + '</td>' + '<td>' + total_price + '</td>' +
				'<input type="hidden" name="item[' + item_id + '][qty][]" value="' + qty + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][unit_price][]" value="' + price + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][uom][]" value="' + uom + '"/>' +
				'<input type="hidden" name="item[' + item_id + '][total_price][]" value="' + total_price + '"/>' +
				'<input type="hidden" class="sorts" name="item[' + item_id + '][sort][]" value="' + sort + '"/>' +
				'<td><a class="edit" href="#"><img src="/images/icons/dark/pencil.png" alt="edit"></a><a class="delete" href="#"><img src="/images/icons/dark/close.png" alt="delete"></a></td>';

			$('#item_body').append(str);

		}

		function getcustomerbyid(id) {
			$('.loading').show();
			$.ajax({
				url: '/customer/fetchbyid/id/' + id,
				type: "get",
				success: function(data) {
					var result = jQuery.parseJSON(data);
					if (result != null) {
						$('#quote').val(result.name);
						$('#customer_id').val(id);
						$('#address').val(result.phys_address1 + ' ' + result.phys_address2 + ' ' + result.phys_city + ' ' + result.mail_state + ' ' + result.phys_country + ' ' + result.mail_postal_code);
						$('#tel').val(result.tel);
						$('#contact').val(result.first_name + ' ' + result.last_name);
						$('#customer_email').val(result.email);
						$('#sale_rep').val(result.sale_rep);

					} else {
						alert('Can\'t find customer');
						$('#customer_info input').val('');
					}
					$('.loading').hide();
				}
			});
		}
		$('#add_new_mode').on("click", function() {
			$('#quote,#address, #tel').removeAttr('readonly').val('');
			$('#customer_id').attr('readonly', 'readonly').val('');
			$('#contact,#customer_email').val('');
			$('#quote, #address, #tel,#customer_email').addClass('validate[required]');
			$('#add_new_mode').hide();
			$('#discard_new_mode').show();
		});
		$('#discard_new_mode').on("click", function() {
			$('#address, #tel').attr('readonly', 'readonly').val('');
			$('#quote').val('');
			$('#customer_id').removeAttr('readonly').val('');
			$('#contact,#customer_email').val('');
			$('#quote, #address, #tel,#customer_email').removeClass('validate[required]');
			$('#add_new_mode').show();
			$('#discard_new_mode').hide();
		});

		$("#uom,#uniform-uom").change(function() {
			getprice();
			return false;
		});
		$("#item_body .delete").live('click', function(e) {
			$(this).parent().parent().remove();
			e.preventDefault();
		});

		$("#customer_email").autocomplete({
			source: "/customer/email/",
			minLength: 2,
			select: function(event, ul) {
				getcustomerbyid(ul.item.customer_id);
			}
		}).data("autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>" + item.email + "<br>" + item.first_name + ' ' + item.last_name + "</a>")
				.appendTo(ul);
		};
		$("#quote").autocomplete({
			source: "/customer/quote/",
			minLength: 2,
			select: function(event, ul) {
				getcustomerbyid(ul.item.customer_id);
			}
		}).data("autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>Company: " + item.name + "<br>" + item.fullname + ' ' + item.city + ' ' + item.tel + "</a>")
				.appendTo(ul);
		};
		$("#contact").autocomplete({
			source: "/customer/name/",
			minLength: 2,
			select: function(event, ul) {
				getcustomerbyid(ul.item.customer_id);
			},

		}).data("autocomplete")._renderItem = function(ul, item) {
			return $("<li></li>")
				.data("item.autocomplete", item)
				.append("<a>Company: " + item.name + "<br>" + item.fullname + ' ' + item.city + ' ' + item.tel + "</a>")
				.appendTo(ul);
		};

		$('a.save_quote').on("click", function(e) {
			e.preventDefault();
			if ($("#quote_content").validationEngine('validate') == true) {
				$('.loading').show();
				$('#quote_content').submit();
			}
		});
		$('a.delete_quote').on("click", function(e) {
			if (confirm("Confirm delete This Quote?") == true) {

			} else {
				e.preventDefault();
			}
		});

		$('a.ready_quote').on("click", function(e) {
			if (confirm("Click OK to submit quote without changes.\nClick CANCEL to return to edit.") == true) {
				e.preventDefault();
				$('.loading').show();
				$.ajax({
					url: "/quote/ready/id/<?= $this->quote['quote_id'] ?>",
					type: "get",
					success: function(data) {
						$('#status').html('<div class="nNote nInformation hideit"><p><strong>INFORMATION: </strong>Your Quote is Waiting for Approval.</p></div>');
						$('a.ready_quote').hide();
					}
				});
				$('.loading').hide();
			} else {
				e.preventDefault();
			}
		});

		$('a.disapprove_quote').on("click", function(e) {
			if (confirm("You need submit again after edit!") == true) {
				e.preventDefault();
				$('.loading').show();
				$.ajax({
					url: "/quote/disapprove/id/<?= $this->quote['quote_id'] ?>",
					type: "get",
					success: function(data) {
						$('#status').html('<div class="nNote nInformation hideit"><p><strong>INFORMATION: </strong>You Need submit again after edit</p></div>');
						location.reload();
					}
				});
				$('.loading').hide();
			} else {
				e.preventDefault();
			}
		});



	});
</script>

<!-- Right panel -->
<div>
</div>